<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Common Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* ==================== å¯¼èˆªæ  ==================== */
        .navbar {
            background: rgba(255, 255, 255, 0.98);
            padding: 0 30px;
            height: 70px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-size: 24px;
            font-weight: 700;
            margin-right: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            flex: 1;
            list-style: none;
        }

        .nav-item {
            height: 70px;
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .nav-item:hover {
            color: #667eea;
        }

        .nav-item.active {
            color: #667eea;
            font-weight: 600;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        /* ==================== å¯¼èˆªæ å³ä¾§ ==================== */
        .navbar-right {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-left: auto;
        }

        .language-switcher {
            position: relative;
        }

        .lang-btn {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            background: #667eea;
            color: white;
        }

        .user-menu {
            position: relative;
        }

        .user-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .user-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            display: none;
            z-index: 1001;
            margin-top: 10px;
            animation: slideDown 0.3s;
        }

        .user-menu-dropdown.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-menu-dropdown a {
            display: block;
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
            border-bottom: 1px solid #f0f0f0;
        }

        .user-menu-dropdown a:last-child {
            border-bottom: none;
        }

        .user-menu-dropdown a:hover {
            background: #f5f5f5;
            color: #667eea;
            padding-left: 20px;
        }

        .user-menu-dropdown hr {
            border: none;
            border-top: 1px solid #f0f0f0;
            margin: 0;
        }

        /* ==================== å®¹å™¨ ==================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #333;
        }

        .page-header p {
            color: #666;
            font-size: 16px;
        }

        /* ==================== é¡µé¢å†…å®¹ ==================== */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ==================== é—®ç­”é¡µé¢ ==================== */
        .qa-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        .qa-main {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ==================== æ ‡ç­¾é¡µ ==================== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            font-size: 14px;
            color: #999;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .response-area {
            min-height: 300px;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 600px;
        }

        .qa-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .qa-question {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .qa-answer {
            color: #666;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            margin-bottom: 10px;
        }

        .qa-meta {
            margin-top: 10px;
            font-size: 12px;
            color: #999;
        }

        /* ==================== è¿›åº¦æ¡å’Œè¿½è¸ªæŒ‰é’® ==================== */
        @keyframes progress {
            0% { 
                width: 0%; 
                opacity: 0.8;
            }
            15% { 
                width: 20%; 
            }
            30% { 
                width: 40%; 
            }
            50% { 
                width: 60%; 
            }
            70% { 
                width: 80%; 
            }
            85% { 
                width: 90%; 
            }
            100% { 
                width: 100%; 
                opacity: 1;
            }
        }

        .progress-bar {
            will-change: width;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trace-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .trace-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .trace-btn:active {
            transform: translateY(0);
        }

        /* ==================== ä¾§è¾¹æ å¡ç‰‡ ==================== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .service-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 6px;
            font-size: 13px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .status-dot.healthy {
            background: #4caf50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .status-dot.unhealthy {
            background: #ff9800;
        }

        .status-dot.offline {
            background: #f44336;
        }

        /* ==================== ç½‘æ ¼å¡ç‰‡ ==================== */
        .grid-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .grid-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .grid-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .grid-card ul {
            list-style: none;
        }

        .grid-card li {
            padding: 10px;
            color: #666;
            font-size: 14px;
            background: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .grid-card li:last-child {
            margin-bottom: 0;
        }

        /* ==================== è¯¦æƒ…é¡µé¢ ==================== */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .detail-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .detail-card h4 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #333;
        }

        .detail-value {
            color: #666;
            text-align: right;
            flex: 1;
            margin-left: 20px;
        }

        /* ==================== åŠ è½½åŠ¨ç”» ==================== */
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f0f0f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ==================== å“åº”å¼ ==================== */
        @media (max-width: 1024px) {
            .qa-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                flex-direction: row;
            }

            .card {
                flex: 1;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 15px;
            }

            .nav-menu {
                gap: 15px;
                font-size: 14px;
            }

            .container {
                padding: 20px 15px;
            }

            .page-header {
                padding: 20px;
            }

            .page-header h1 {
                font-size: 24px;
            }
        }

        /* ==================== è¾“å…¥æ¡†æ ·å¼å¢å¼º ==================== */
        .search-input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ==================== è¡¨æ ¼æ ·å¼ ==================== */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }

        .table thead {
            background: #f9f9f9;
            border-bottom: 2px solid #e0e0e0;
        }

        .table th,
        .table td {
            padding: 12px 15px;
            text-align: left;
            font-size: 14px;
        }

        .table tbody tr:hover {
            background: #f5f5f5;
        }

        .table tbody tr {
            border-bottom: 1px solid #e0e0e0;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
            animation: slideDown 0.3s;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #66bb6a;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }

        /* åŠ è½½é®ç½©è¿‡æ¸¡ */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease-out, visibility 0s ease-out 0.3s;
        }

        #loadingOverlay.hide {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <!-- åˆå§‹åŒ–åŠ è½½é®ç½©ï¼ˆé˜²æ­¢é¡µé¢é—ªçƒï¼‰ -->
    <div id="loadingOverlay">
        <div style="text-align: center;">
            <div style="width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
            <div style="color: #666; font-size: 14px;">æ­£åœ¨åŠ è½½...</div>
        </div>
    </div>
    <!-- å¯¼èˆªæ  -->
    <div class="navbar">
        <div class="navbar-brand">ğŸ¤– AI Platform</div>
        <ul class="nav-menu" id="navMenu">
            <li class="nav-item active" data-page="qa" onclick="switchPage('qa', event)">ğŸ’¬ é—®ç­”ä¸­å¿ƒ</li>
            <li class="nav-item" data-page="prompt" onclick="switchPage('prompt', event)">ğŸ“ Prompt ç®¡ç†</li>
            <li class="nav-item" data-page="rag" onclick="switchPage('rag', event)">ğŸ“š çŸ¥è¯†åº“</li>
            <li class="nav-item" data-page="agent" onclick="switchPage('agent', event)">ğŸ¤– Agent å·¥å…·</li>
            <li class="nav-item" data-page="integration" onclick="switchPage('integration', event)">ğŸ”— ç³»ç»Ÿé›†æˆ</li>
            <li class="nav-item" data-page="llm" onclick="switchPage('llm', event)">ğŸ§  å¤§æ¨¡å‹</li>
            <li class="nav-item" data-page="monitor" onclick="switchPage('monitor', event)">ğŸ“Š ç›‘æ§é¢æ¿</li>
        </ul>
        
        <!-- ç”¨æˆ·èœå•å’Œè¯­è¨€åˆ‡æ¢ -->
        <div class="navbar-right">
            <div class="language-switcher">
                <button id="langToggle" class="lang-btn" onclick="toggleLanguage()">
                    <span id="langDisplay">ä¸­æ–‡</span>
                </button>
            </div>
            
            <div class="user-menu">
                <button id="userMenuBtn" class="user-btn" onclick="toggleUserMenu()">
                    ğŸ‘¤ <span id="userName">User</span>
                </button>
                <div id="userMenuDropdown" class="user-menu-dropdown">
                    <a href="#" onclick="viewUserProfile(event)">ğŸ‘¤ ä¸ªäººèµ„æ–™</a>
                    <a href="#" onclick="viewQAHistory(event)">ğŸ“‹ æˆ‘çš„é—®ç­”</a>
                    <a href="#" onclick="viewSettings(event)">âš™ï¸ è®¾ç½®</a>
                    <hr>
                    <a href="#" onclick="handleLogout(event)">ğŸšª ç™»å‡º</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é—®ç­”ä¸­å¿ƒ -->
        <div id="qa-page" class="page-content active">
            <div class="page-header">
                <h1>ğŸ’¬ é—®ç­”ä¸­å¿ƒ</h1>
                <p>è¾“å…¥é—®é¢˜ï¼ŒAI å°†ä¸ºæ‚¨æä¾›æ™ºèƒ½å›ç­”</p>
            </div>

            <div class="qa-layout">
                <div class="qa-main">
                    <div class="input-group">
                        <input type="text" id="questionInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜...">
                        <button class="btn" onclick="askQuestion()">æé—®</button>
                        <label for="enableTrace" style="display: flex; align-items: center; gap: 8px; color: #667eea; font-size: 14px; cursor: pointer;">
                            <input type="checkbox" id="enableTrace" style="width: 18px; height: 18px; cursor: pointer;">
                            æ˜¾ç¤ºè°ƒç”¨é“¾
                        </label>
                    </div>

                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchQATab('history')">å›ç­”å†å²</button>
                        <button class="tab-btn" onclick="switchQATab('search')">çŸ¥è¯†åº“æœç´¢</button>
                        <button class="tab-btn" onclick="switchQATab('trace')">è°ƒç”¨é“¾è¿½è¸ª</button>
                    </div>

                    <div id="qa-history-tab" class="tab-content active">
                        <div id="responseArea" class="response-area">
                            <p style="color: #999; text-align: center;">æé—®åï¼Œå›ç­”å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>

                    <div id="qa-search-tab" class="tab-content">
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢çŸ¥è¯†åº“..." style="flex: 1;">
                            <button class="btn" onclick="searchKnowledge()">æœç´¢</button>
                        </div>
                        <div id="searchResults" class="response-area">
                            <p style="color: #999; text-align: center;">æœç´¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>

                    <div id="qa-trace-tab" class="tab-content">
                        <div id="traceArea" class="response-area" style="max-height: 800px; overflow-y: auto;">
                            <p style="color: #999; text-align: center;">å‹¾é€‰"æ˜¾ç¤ºè°ƒç”¨é“¾"åï¼Œæé—®æ—¶å°†æ˜¾ç¤ºå®Œæ•´çš„å¤„ç†æµç¨‹</p>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <h3>ğŸŸ¢ æœåŠ¡çŠ¶æ€</h3>
                        <div id="serviceStatus">
                            <div class="service-item">
                                <div class="status-dot healthy"></div>
                                <span>æ‰€æœ‰æœåŠ¡æ­£å¸¸</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>âš™ï¸ ç³»ç»Ÿä¿¡æ¯</h3>
                        <div class="detail-item">
                            <span class="detail-label">ç‰ˆæœ¬</span>
                            <span class="detail-value">1.0.0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ç¯å¢ƒ</span>
                            <span class="detail-value">è½»é‡ç‰ˆ</span>
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <!-- Prompt ç®¡ç† -->
        <div id="prompt-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ“ Prompt ç®¡ç†</h1>
                <p>æŸ¥çœ‹å’Œç®¡ç† AI åŠ©æ‰‹è§’è‰²é…ç½®</p>
            </div>

            <div class="detail-grid">
                <div class="detail-card">
                    <h4>ğŸ­ é”€å”®é¡¾é—®</h4>
                    <div class="detail-item">
                        <span class="detail-label">è§’è‰²</span>
                        <span class="detail-value">é”€å”®æ•°æ®åˆ†æä¸“å®¶</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ä¸“é•¿</span>
                        <span class="detail-value">é”€å”®é¢ã€è®¢å•ã€å®¢æˆ·</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²å¯ç”¨</span></span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ‘¨â€ğŸ’¼ HR é¡¾é—®</h4>
                    <div class="detail-item">
                        <span class="detail-label">è§’è‰²</span>
                        <span class="detail-value">äººåŠ›èµ„æºç®¡ç†ä¸“å®¶</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ä¸“é•¿</span>
                        <span class="detail-value">å‘˜å·¥ä¿¡æ¯ã€è–ªèµ„ã€ç¦åˆ©</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²å¯ç”¨</span></span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ’» æŠ€æœ¯é¡¾é—®</h4>
                    <div class="detail-item">
                        <span class="detail-label">è§’è‰²</span>
                        <span class="detail-value">æŠ€æœ¯æ¶æ„è®¾è®¡ä¸“å®¶</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ä¸“é•¿</span>
                        <span class="detail-value">ç³»ç»Ÿã€æ¶æ„ã€æŠ€æœ¯æ–¹æ¡ˆ</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²å¯ç”¨</span></span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ’° è´¢åŠ¡é¡¾é—®</h4>
                    <div class="detail-item">
                        <span class="detail-label">è§’è‰²</span>
                        <span class="detail-value">è´¢åŠ¡åˆ†æä¸“å®¶</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ä¸“é•¿</span>
                        <span class="detail-value">è´¢åŠ¡æŠ¥è¡¨ã€é¢„ç®—ã€æˆæœ¬</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²å¯ç”¨</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŸ¥è¯†åº“ -->
        <div id="rag-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ“š çŸ¥è¯†åº“ç®¡ç†</h1>
                <p>ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“ï¼Œæ”¯æŒæ–‡æ¡£æœç´¢å’Œæ£€ç´¢</p>
            </div>

            <div class="grid-section">
                <div class="grid-card">
                    <h3>ğŸ“„ æœ€è¿‘æ›´æ–°</h3>
                    <ul id="ragDocuments">
                        <li>Q1 é”€å”®æŠ¥å‘Š - 2026-01-20</li>
                        <li>å‘˜å·¥æ‰‹å†Œ v2.1 - 2026-01-18</li>
                        <li>æŠ€æœ¯è§„èŒƒæ–‡æ¡£ - 2026-01-15</li>
                        <li>è´¢åŠ¡åˆ¶åº¦è¯´æ˜ - 2026-01-10</li>
                        <li>ä¸šåŠ¡æµç¨‹æŒ‡å— - 2026-01-05</li>
                    </ul>
                </div>

                <div class="grid-card">
                    <h3>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h3>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="detail-label">æ–‡æ¡£æ€»æ•°</td>
                                <td class="detail-value">128</td>
                            </tr>
                            <tr>
                                <td class="detail-label">æ€»å®¹é‡</td>
                                <td class="detail-value">2.4 GB</td>
                            </tr>
                            <tr>
                                <td class="detail-label">ä»Šæ—¥æ£€ç´¢</td>
                                <td class="detail-value">45 æ¬¡</td>
                            </tr>
                            <tr>
                                <td class="detail-label">å¹³å‡å“åº”</td>
                                <td class="detail-value">0.32 ç§’</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid-card">
                    <h3>ğŸ·ï¸ æ–‡æ¡£åˆ†ç±»</h3>
                    <ul>
                        <li>ğŸ“‹ è§„èŒƒæ–‡æ¡£ (32 ä¸ª)</li>
                        <li>ğŸ“Š æŠ¥è¡¨æ•°æ® (28 ä¸ª)</li>
                        <li>ğŸ’¼ ä¸šåŠ¡æµç¨‹ (25 ä¸ª)</li>
                        <li>ğŸ”§ æŠ€æœ¯æ–‡æ¡£ (21 ä¸ª)</li>
                        <li>ğŸ“ åŸ¹è®­èµ„æ–™ (22 ä¸ª)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Agent å·¥å…· -->
        <div id="agent-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ¤– Agent å·¥å…·</h1>
                <p>AI Agent å¯ä»¥ä½¿ç”¨çš„å·¥å…·å’Œé›†æˆèƒ½åŠ›</p>
            </div>

            <div class="detail-grid">
                <div class="detail-card">
                    <h4>ğŸ“Š é”€å”®æ•°æ®æŸ¥è¯¢</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æŸ¥è¯¢é”€å”®é¢ã€è®¢å•</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">2,345</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">99.2%</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ‘¥ å‘˜å·¥ä¿¡æ¯æŸ¥è¯¢</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ã€è–ªèµ„</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">1,823</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">98.5%</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ’» ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ã€æ—¥å¿—</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">892</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">100%</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ“ˆ è´¢åŠ¡æŠ¥è¡¨</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æŸ¥è¯¢è´¢åŠ¡æŠ¥è¡¨ã€æˆæœ¬</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">654</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">99.8%</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ“§ é‚®ä»¶å‘é€</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">å‘é€é‚®ä»¶é€šçŸ¥</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">456</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">97.5%</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ”” æ¶ˆæ¯é€šçŸ¥</h4>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æ¨é€æ¶ˆæ¯æé†’</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">è°ƒç”¨æ¬¡æ•°</span>
                        <span class="detail-value">3,210</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æˆåŠŸç‡</span>
                        <span class="detail-value">99.1%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿé›†æˆ -->
        <div id="integration-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ”— ç³»ç»Ÿé›†æˆ</h1>
                <p>ä¸ä¼ä¸šå„ç±»ç³»ç»Ÿçš„é›†æˆçŠ¶æ€å’Œé…ç½®</p>
            </div>

            <div class="detail-grid">
                <div class="detail-card">
                    <h4>ğŸª ERP ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">SAP ERP</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 18:20</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">è®¢å•ã€åº“å­˜ã€è´¢åŠ¡</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ‘¥ HRM ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">é‡‘è¶ HRM</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 18:15</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">å‘˜å·¥ã€è–ªèµ„ã€è€ƒå‹¤</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ’¼ CRM ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">Salesforce CRM</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 18:10</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">å®¢æˆ·ã€å•†æœºã€é”€å”®</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ’° è´¢åŠ¡ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">ç”¨å‹è´¢åŠ¡</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 18:05</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">æŠ¥è¡¨ã€å‡­è¯ã€é¢„ç®—</span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ“ ç”µè¯ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">æ€ç§‘ IP ç”µè¯</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 18:00</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">é€šè¯è®°å½•ã€å®¢æˆ·å·ç </span>
                    </div>
                </div>

                <div class="detail-card">
                    <h4>ğŸ“§ é‚®ä»¶ç³»ç»Ÿ</h4>
                    <div class="detail-item">
                        <span class="detail-label">ç³»ç»Ÿ</span>
                        <span class="detail-value">Exchange é‚®ç®±</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">çŠ¶æ€</span>
                        <span class="detail-value"><span class="tag">å·²è¿æ¥</span></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">æœ€ååŒæ­¥</span>
                        <span class="detail-value">2026-01-26 17:55</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åŠŸèƒ½</span>
                        <span class="detail-value">é‚®ä»¶æ”¶å‘ã€æ—¥ç¨‹</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- LLM å¤§æ¨¡å‹ -->
        <div id="llm-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ§  å¤§æ¨¡å‹ç®¡ç†</h1>
                <p>é…ç½®ã€ç®¡ç†å’Œé€‰æ‹© AI å¤§æ¨¡å‹æ¥å£</p>
            </div>

            <!-- æ¨¡å‹ç®¡ç†å·¥å…·æ  -->
            <div style="margin-bottom: 20px; padding: 15px; background: #f5f7fa; border-radius: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" onclick="openLLMModelsPage()" style="background: #667eea;">ğŸš€ å®Œæ•´é…ç½®é¡µé¢</button>
                <button class="btn" onclick="switchLLMTab('list')" style="background: #764ba2;">ğŸ“‹ æ¨¡å‹åˆ—è¡¨</button>
                <button class="btn" onclick="switchLLMTab('add')" style="background: #48bb78;">â• æ·»åŠ æ¨¡å‹</button>
                <button class="btn" onclick="refreshLLMModels()" style="background: #ed8936;">ğŸ”„ åˆ·æ–°</button>
            </div>

            <!-- å®Œæ•´é…ç½®é¡µé¢é“¾æ¥ -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: none;" id="configPageTip">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin-bottom: 8px;">ğŸ’¡ æ¨èä½¿ç”¨å®Œæ•´é…ç½®é¡µé¢</h3>
                        <p style="opacity: 0.9;">æ”¯æŒ OpenAI å’Œ ChatAnywhere ç­‰å¤šä¸ªæä¾›å•†ï¼Œæ›´å¼ºå¤§çš„é…ç½®å’Œç®¡ç†åŠŸèƒ½</p>
                    </div>
                    <button onclick="openLLMModelsPage()" style="background: white; color: #667eea; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å‰å¾€é…ç½®</button>
                </div>
            </div>

            <!-- æ¨¡å‹åˆ—è¡¨ Tab -->
            <div id="llm-list-tab" style="display: block;">
                <div id="llmModelsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„æ¨¡å‹å¡ç‰‡ -->
                </div>
            </div>

            <!-- æ·»åŠ æ¨¡å‹ Tab -->
            <div id="llm-add-tab" style="display: none;">
                <div style="background: white; padding: 25px; border-radius: 10px; max-width: 600px; margin: 0 auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">â• æ·»åŠ æ–°çš„ LLM æ¨¡å‹</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">æ¨¡å‹åç§° <span style="color: red;">*</span></label>
                        <input type="text" id="llmName" placeholder="ä¾‹å¦‚: gpt-4, claude-3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">æä¾›å•† <span style="color: red;">*</span></label>
                        <select id="llmProvider" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                            <option value="">-- é€‰æ‹©æä¾›å•† --</option>
                            <option value="openai">OpenAI</option>
                            <option value="chatanywhere">ChatAnywhere</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">æ¨¡å‹ç±»å‹</label>
                        <select id="llmType" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                            <option value="api">API æ¨¡å‹</option>
                            <option value="local">æœ¬åœ°æ¨¡å‹</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">API ç«¯ç‚¹</label>
                        <input type="text" id="llmEndpoint" placeholder="https://api.openai.com/v1/chat/completions" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">API å¯†é’¥</label>
                        <input type="password" id="llmApiKey" placeholder="sk-..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Base URL</label>
                        <input type="text" id="llmBaseUrl" placeholder="https://api.openai.com/v1" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">æœ€å¤§ Tokens</label>
                            <input type="number" id="llmMaxTokens" value="2048" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Temperature</label>
                            <input type="number" id="llmTemperature" value="0.7" min="0" max="2" step="0.1" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">æè¿°</label>
                        <textarea id="llmDescription" placeholder="æ¨¡å‹çš„åŠŸèƒ½æè¿°..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; height: 80px;"></textarea>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="saveLLMModel()" style="flex: 1; background: #667eea;">ğŸ’¾ ä¿å­˜æ¨¡å‹</button>
                        <button class="btn" onclick="switchLLMTab('list')" style="flex: 1; background: #999;">âŒ å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç›‘æ§é¢æ¿ -->
        <div id="monitor-page" class="page-content">
            <div class="page-header">
                <h1>ğŸ“Š ç›‘æ§é¢æ¿</h1>
                <p>ç³»ç»Ÿå®æ—¶ç›‘æ§å’Œæ€§èƒ½ç»Ÿè®¡</p>
            </div>

            <div class="grid-section">
                <div class="grid-card">
                    <h3>ğŸ“ˆ ç³»ç»Ÿæ€§èƒ½</h3>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="detail-label">CPU ä½¿ç”¨ç‡</td>
                                <td class="detail-value">23.4%</td>
                            </tr>
                            <tr>
                                <td class="detail-label">å†…å­˜ä½¿ç”¨</td>
                                <td class="detail-value">512 MB / 1 GB</td>
                            </tr>
                            <tr>
                                <td class="detail-label">ç£ç›˜ç©ºé—´</td>
                                <td class="detail-value">2.3 GB / 5 GB</td>
                            </tr>
                            <tr>
                                <td class="detail-label">ç½‘ç»œ I/O</td>
                                <td class="detail-value">4.5 Mbps</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid-card">
                    <h3>ğŸ¯ æœåŠ¡æŒ‡æ ‡</h3>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="detail-label">QA æœåŠ¡</td>
                                <td class="detail-value">99.5%</td>
                            </tr>
                            <tr>
                                <td class="detail-label">RAG æœåŠ¡</td>
                                <td class="detail-value">98.8%</td>
                            </tr>
                            <tr>
                                <td class="detail-label">LLM æœåŠ¡</td>
                                <td class="detail-value">99.2%</td>
                            </tr>
                            <tr>
                                <td class="detail-label">å¹³å‡å“åº”</td>
                                <td class="detail-value">0.45 ç§’</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid-card">
                    <h3>ğŸ“Š ä»Šæ—¥ç»Ÿè®¡</h3>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="detail-label">æ€»æé—®æ•°</td>
                                <td class="detail-value">1,234</td>
                            </tr>
                            <tr>
                                <td class="detail-label">çŸ¥è¯†åº“æœç´¢</td>
                                <td class="detail-value">5,678</td>
                            </tr>
                            <tr>
                                <td class="detail-label">Agent æ‰§è¡Œ</td>
                                <td class="detail-value">234</td>
                            </tr>
                            <tr>
                                <td class="detail-label">æ´»è·ƒç”¨æˆ·</td>
                                <td class="detail-value">87</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid-card">
                    <h3>âš ï¸ å‘Šè­¦ä¿¡æ¯</h3>
                    <ul id="alerts">
                        <li style="color: #4caf50;">âœ… æ‰€æœ‰æœåŠ¡æ­£å¸¸</li>
                        <li style="color: #4caf50;">âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸</li>
                        <li style="color: #4caf50;">âœ… ç¼“å­˜æœåŠ¡æ­£å¸¸</li>
                        <li style="color: #4caf50;">âœ… å¤–éƒ¨ API å¯ç”¨</li>
                    </ul>
                </div>

                <div class="grid-card">
                    <h3>ğŸ”„ æœ€è¿‘æ´»åŠ¨</h3>
                    <ul id="recentActivity">
                        <li>2026-01-26 18:45 - ç”¨æˆ·æé—®ï¼šé”€å”®æ•°æ®</li>
                        <li>2026-01-26 18:40 - RAG æœç´¢ï¼šäº§å“è§„æ ¼</li>
                        <li>2026-01-26 18:35 - Agent æ‰§è¡Œï¼šæ•°æ®å¯¼å‡º</li>
                        <li>2026-01-26 18:30 - LLM è°ƒç”¨ï¼šæ–‡æœ¬ç”Ÿæˆ</li>
                        <li>2026-01-26 18:25 - çŸ¥è¯†åº“åŒæ­¥ï¼šæ›´æ–° 5 ä¸ªæ–‡æ¡£</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¼šè¯ç®¡ç†å’Œå›½é™…åŒ–å·²ç¦ç”¨ -->

    <script>
        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        
        // è®¾ç½®é»˜è®¤ç”¨æˆ·å
        function initializeUser() {
            const userNameEl = document.getElementById('userName');
            if (userNameEl) {
                userNameEl.textContent = 'è®¿å®¢ç”¨æˆ·';
            }
        }

        // éšè—åŠ è½½é®ç½© - ä½¿ç”¨ CSS class æ›¿ä»£å†…è”æ ·å¼
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            console.log('[INIT] hideLoadingOverlay called, overlay exists:', !!overlay);
            if (overlay) {
                // æ·»åŠ  hide class è§¦å‘è¿‡æ¸¡åŠ¨ç”»
                overlay.classList.add('hide');
                console.log('[INIT] hide class added to overlay');
                // ç­‰å¾…è¿‡æ¸¡å®Œæˆåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (overlay && overlay.parentNode) {
                        overlay.remove();
                        console.log('[INIT] overlay removed from DOM');
                    }
                }, 400);  // è¿‡æ¸¡æ—¶é—´ 300ms + ç¼“å†² 100ms
            } else {
                console.warn('[INIT] loadingOverlay element not found');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæ—¶éšè—åŠ è½½é®ç½©
        if (document.readyState === 'loading') {
            // æ–‡æ¡£è¿˜åœ¨åŠ è½½
            document.addEventListener('DOMContentLoaded', () => {
                console.log('[INIT] DOMContentLoaded event fired');
                initializeUser();
                hideLoadingOverlay();
            }, { once: true });
        } else {
            // æ–‡æ¡£å·²åŠ è½½
            console.log('[INIT] Document already loaded');
            initializeUser();
            hideLoadingOverlay();
        }

        // ç›‘å¬è¯­è¨€å˜åŒ–äº‹ä»¶
        window.addEventListener('languageChanged', (event) => {
            console.log('[UI] Language changed to: ' + event.detail.language);
        });

        // ==================== ç”¨æˆ·èœå•æ“ä½œ ====================

        function toggleUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            dropdown.classList.toggle('active');

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹æ—¶å…³é—­èœå•
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.user-menu')) {
                    dropdown.classList.remove('active');
                }
            });
        }

        async function toggleLanguage() {
            // è¯­è¨€åˆ‡æ¢ï¼ˆæœ¬åœ°ä»…åˆ‡æ¢ï¼‰
            const currentLang = localStorage.getItem('language') || 'zh';
            const newLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('language', newLang);
            alert(`è¯­è¨€å·²åˆ‡æ¢ä¸º${newLang === 'zh' ? 'ä¸­æ–‡' : 'English'}`);
        }

        function viewUserProfile(event) {
            event.preventDefault();
            alert('ç”¨æˆ·ä¿¡æ¯\n\nç”¨æˆ·å: è®¿å®¢ç”¨æˆ·\nè§’è‰²: æ¸¸å®¢\nè¯­è¨€: ä¸­æ–‡');
        }

        function viewQAHistory(event) {
            event.preventDefault();
            switchPage('qa', event);
        }

        function viewSettings(event) {
            event.preventDefault();
            alert('è®¾ç½®åŠŸèƒ½å³å°†ä¸Šçº¿');
        }

        async function handleLogout(event) {
            event.preventDefault();
            if (confirm('ç¡®è®¤é€€å‡ºï¼Ÿ')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== åŠ è½½ç”¨æˆ·é—®ç­”å†å² ====================

        async function loadUserQAHistory() {
            // å·²ç¦ç”¨ç™»é™†ç³»ç»Ÿï¼Œä¸å†éœ€è¦åŠ è½½å†å²è®°å½•
            console.log('[UI] QA history loading skipped (login disabled)');
        }

        // ==================== é¡µé¢åˆ‡æ¢ ====================

        function switchPage(page, event) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰å¯¼èˆªé¡¹çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });
            
            // æ¿€æ´»é€‰ä¸­çš„é¡µé¢å’Œå¯¼èˆªé¡¹
            document.getElementById(page + '-page').classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // å¦‚æœæ²¡æœ‰ event å¯¹è±¡ï¼Œé€šè¿‡ data-page å±æ€§æŸ¥æ‰¾å¯¹åº”çš„å¯¼èˆªé¡¹
                document.querySelector('[data-page="' + page + '"]')?.classList.add('active');
            }
        }

        // ==================== QA Tab åˆ‡æ¢ ====================

        function switchQATab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
            });
            
            document.getElementById('qa-' + tab + '-tab').classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            const tabButton = document.querySelector('[data-tab="' + tab + '"]');
            if (tabButton) {
                tabButton.classList.add('active');
            }
        }

        // ==================== é—®ç­”åŠŸèƒ½ ====================
        
        // å…¨å±€å˜é‡å­˜å‚¨å½“å‰çš„è°ƒç”¨é“¾æ•°æ®
        window.currentTraceData = null;

        async function askQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            const enableTrace = document.getElementById('enableTrace').checked;
            
            if (!question) {
                showAlert('è¯·è¾“å…¥é—®é¢˜', 'error');
                return;
            }

            try {
                // æ¸…ç©ºå“åº”åŒºåŸŸ
                const responseArea = document.getElementById('responseArea');
                const loadingItemId = 'loading-' + Date.now();
                
                // æ˜¾ç¤ºåŠ è½½è¿›åº¦æ¡ï¼ˆåªä¿®æ”¹ä¸€æ¬¡ DOMï¼‰
                responseArea.innerHTML = `
                    <div id="${loadingItemId}" class="qa-item qa-loading" style="animation: fadeIn 0.3s ease-in; background: #f0f4ff; border-left-color: #667eea;">
                        <div class="qa-question">Q: ${escapeHtml(question)}</div>
                        <div style="margin: 15px 0;">
                            <div style="font-size: 13px; color: #667eea; margin-bottom: 8px; font-weight: 600;">
                                â³ æ­£åœ¨å¤„ç†æ‚¨çš„é—®é¢˜...
                            </div>
                            <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);">
                                <div class="progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 4px; animation: progress 8s ease-in-out forwards;"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // æ ¹æ®æ˜¯å¦å¯ç”¨è¿½è¸ªé€‰æ‹©ä¸åŒçš„ API
                const endpoint = enableTrace ? '/api/trace/qa/ask' : '/api/qa/ask';
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: question,
                        token: null
                    })
                });

                const data = await response.json();
                
                // ç§»é™¤åŠ è½½é¡¹
                const loadingItem = document.getElementById(loadingItemId);
                if (loadingItem) loadingItem.remove();
                
                // ä¿å­˜è°ƒç”¨é“¾æ•°æ®åˆ°å…¨å±€å˜é‡
                if (enableTrace && data.trace) {
                    window.currentTraceData = data.trace;
                    console.log('[TRACE] å·²ä¿å­˜è°ƒç”¨é“¾æ•°æ®:', data.trace);
                }
                
                // æ˜¾ç¤ºç­”æ¡ˆ
                displayQAResponse(data, enableTrace);
                
                document.getElementById('questionInput').value = '';
                showAlert('âœ“ é—®é¢˜å·²å¤„ç†', 'success');

            } catch (error) {
                // ç§»é™¤åŠ è½½é¡¹
                const loadingItem = document.querySelector('[id^="loading-"]');
                if (loadingItem) loadingItem.remove();
                
                showAlert('âœ• æé—®å¤±è´¥: ' + error.message, 'error');
                // æ˜¾ç¤ºå‡æ•°æ®
                displayQAResponse({
                    question: question,
                    answer: 'æ ¹æ®æˆ‘çš„åˆ†æï¼Œ' + question + '\n\nå›ç­”ï¼šè¿™æ˜¯ç¤ºä¾‹å›ç­”ï¼Œå®é™…ç­”æ¡ˆå°†æ ¹æ® RAG æ£€ç´¢ç»“æœå’Œ LLM ç”Ÿæˆçš„å†…å®¹ç»„æˆã€‚',
                    confidence: 0.85,
                    execution_time: 0.45
                }, false);
            }
        }
        
        function displayCallTrace(trace) {
            // æ˜¾ç¤ºè°ƒç”¨é“¾è¿½è¸ª - çœŸå®çš„æœåŠ¡è°ƒç”¨ä¿¡æ¯
            const traceArea = document.getElementById('traceArea');
            
            // å®¹é”™æ£€æŸ¥
            if (!trace || !trace.steps || trace.steps.length === 0) {
                console.warn('[TRACE] è°ƒç”¨é“¾æ•°æ®æ— æ•ˆæˆ–ä¸ºç©º:', trace);
                traceArea.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 15px; border-radius: 8px; text-align: center;">
                        <div>âš ï¸ è°ƒç”¨é“¾æ•°æ®æœªå¯ç”¨</div>
                        <div style="font-size: 12px; margin-top: 8px; color: #666;">
                            è¯·ç¡®ä¿å·²å‹¾é€‰"æ˜¾ç¤ºè°ƒç”¨é“¾"é€‰é¡¹ï¼Œå¹¶é‡æ–°æé—®
                        </div>
                    </div>
                `;
                return;
            }
            
            console.log('[TRACE] æ˜¾ç¤ºè°ƒç”¨é“¾æ•°æ®, æ­¥éª¤æ•°:', trace.steps.length);
            
            let html = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 15px; font-size: 14px;">ğŸ“Š å®Œæ•´çš„è°ƒç”¨é“¾è¿½è¸ªä¿¡æ¯</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; font-size: 13px;">
                        <div>
                            <div style="opacity: 0.8; margin-bottom: 5px;">è¿½è¸ª ID</div>
                            <div style="font-family: monospace; font-weight: 600; word-break: break-all;">${escapeHtml(trace.trace_id || 'N/A')}</div>
                        </div>
                        <div>
                            <div style="opacity: 0.8; margin-bottom: 5px;">æ€»æ­¥éª¤æ•°</div>
                            <div style="font-weight: 600; font-size: 16px;">${trace.steps ? trace.steps.length : 0} æ­¥</div>
                        </div>
                        <div>
                            <div style="opacity: 0.8; margin-bottom: 5px;">æ€»è€—æ—¶</div>
                            <div style="font-weight: 600; font-size: 16px;">${escapeHtml(trace.total_time || 'N/A')}</div>
                        </div>
                        <div>
                            <div style="opacity: 0.8; margin-bottom: 5px;">å¤„ç†æ—¶é—´</div>
                            <div style="font-weight: 600;">${new Date().toLocaleTimeString('zh-CN')}</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 15px; color: #333; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ”„ çœŸå®æœåŠ¡è°ƒç”¨æµç¨‹</span>
                        <span style="font-size: 12px; color: #999;">(${trace.steps ? trace.steps.length : 0} ä¸ªå¤„ç†é˜¶æ®µ)</span>
                    </div>
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #f5f5f5 0%, #fafafa 100%); padding: 15px; border-bottom: 1px solid #e0e0e0; display: grid; grid-template-columns: 5% 20% 30% 25% 20%; gap: 10px; font-size: 12px; font-weight: 600; color: #666;">
                            <div>åºå·</div>
                            <div>æœåŠ¡</div>
                            <div>é˜¶æ®µ</div>
                            <div>ç”¨é€”</div>
                            <div>çŠ¶æ€</div>
                        </div>
            `;
            
            // æ˜¾ç¤ºæ¯ä¸€æ­¥ - çœŸå®çš„æœåŠ¡è°ƒç”¨ä¿¡æ¯
            if (trace.steps && Array.isArray(trace.steps)) {
                trace.steps.forEach((step, index) => {
                    const statusIcon = step.status === 'success' ? 'âœ…' : step.status === 'error' ? 'âŒ' : step.status === 'warning' ? 'âš ï¸' : 'â­ï¸';
                    const backgroundColor = index % 2 === 0 ? '#f9f9f9' : '#ffffff';
                    const borderLeftColor = step.status === 'success' ? '#52c41a' : step.status === 'error' ? '#ff4d4f' : step.status === 'warning' ? '#faad14' : '#1890ff';
                    
                    html += `
                        <div style="padding: 15px; border-bottom: 1px solid #f0f0f0; background: ${backgroundColor}; border-left: 4px solid ${borderLeftColor};">
                            <div style="display: grid; grid-template-columns: 5% 20% 30% 25% 20%; gap: 10px; align-items: start; margin-bottom: 10px; font-size: 13px;">
                                <div style="font-weight: 600; color: #667eea;">Step ${step.seq || index + 1}</div>
                                <div style="color: #666; word-break: break-word;">${escapeHtml(step.service || 'Unknown')}</div>
                                <div style="font-weight: 600; color: #333;">${escapeHtml(step.stage || 'N/A')}</div>
                                <div style="color: #666; font-size: 12px;">${escapeHtml(step.purpose || '')}</div>
                                <div style="text-align: center; font-size: 16px;">${statusIcon}</div>
                            </div>
                            
                            <div style="padding-left: 15px; border-left: 2px dashed #ddd; margin-top: 10px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 12px;">
                                    ${step.data && Object.entries(step.data).map(([key, value]) => {
                                        let displayValue = typeof value === 'object' ? JSON.stringify(value) : String(value || '');
                                        if (displayValue.length > 50) {
                                            displayValue = displayValue.substring(0, 50) + '...';
                                        }
                                        return `
                                            <div style="background: #f5f5f5; padding: 8px; border-radius: 4px; border-left: 2px solid #667eea;">
                                                <div style="color: #999; font-size: 11px; margin-bottom: 3px;">${escapeHtml(key)}</div>
                                                <div style="color: #333; font-family: monospace; word-break: break-all;">${escapeHtml(displayValue)}</div>
                                            </div>
                                        `;
                                    }).join('') || '<div style="color: #999;">æš‚æ— æ•°æ®</div>'}
                                </div>
                            </div>
                            
                            <div style="margin-top: 8px; color: #999; font-size: 11px;">
                                â±ï¸ ${step.timestamp ? new Date(step.timestamp).toLocaleTimeString('zh-CN') : 'N/A'}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `</div>`;
            
            // æ·»åŠ è°ƒç”¨é“¾æ‘˜è¦ç»Ÿè®¡
            const successCount = trace.steps ? trace.steps.filter(s => s.status === 'success').length : 0;
            const warningCount = trace.steps ? trace.steps.filter(s => s.status === 'warning').length : 0;
            const errorCount = trace.steps ? trace.steps.filter(s => s.status === 'error').length : 0;
            const serviceCount = trace.steps ? new Set(trace.steps.map(s => (s.service || '').split('(')[0])).size : 0;
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #f0f5ff; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 10px;">ğŸ“ˆ è°ƒç”¨é“¾ç»Ÿè®¡</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 13px;">
                        <div><span style="color: #999;">æˆåŠŸæ­¥éª¤:</span> <span style="font-weight: 600; color: #52c41a;">${successCount}</span></div>
                        <div><span style="color: #999;">è­¦å‘Šæ­¥éª¤:</span> <span style="font-weight: 600; color: #faad14;">${warningCount}</span></div>
                        <div><span style="color: #999;">é”™è¯¯æ­¥éª¤:</span> <span style="font-weight: 600; color: #ff4d4f;">${errorCount}</span></div>
                        <div><span style="color: #999;">æ¶‰åŠæœåŠ¡:</span> <span style="font-weight: 600;">${serviceCount}</span></div>
                    </div>
                </div>
            `;
            
            traceArea.innerHTML = html;
        }
        

        function displayQAResponse(data, showTraceBtn = false) {
            const responseArea = document.getElementById('responseArea');
            
            // æ ¼å¼åŒ–ç­”æ¡ˆï¼ˆæ”¯æŒæ¢è¡Œï¼‰
            const formattedAnswer = (data.answer || '').replace(/\n/g, '<br>');
            
            let html = `
                <div class="qa-item">
                    <div class="qa-question">Q: ${escapeHtml(data.question || '')}</div>
                    <div class="qa-answer">${formattedAnswer}</div>
                    <div class="qa-meta" style="display: flex; justify-content: space-between; align-items: center;">
                        <span>
                            <span>ç½®ä¿¡åº¦: ${((data.confidence || 0.8) * 100).toFixed(0)}%</span> | 
                            <span>è€—æ—¶: ${(data.execution_time || 0.5).toFixed(2)}s</span>
                        </span>
                        ${showTraceBtn && window.currentTraceData ? `
                            <button class="trace-btn" onclick="displayCallTrace(window.currentTraceData); switchQATab('trace');">
                                ğŸ” æŸ¥çœ‹è°ƒç”¨é“¾
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            responseArea.innerHTML = html + responseArea.innerHTML;
        }
        }

        // ==================== çŸ¥è¯†åº“æœç´¢ ====================

        async function searchKnowledge() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (!query) {
                showAlert('è¯·è¾“å…¥æœç´¢è¯', 'error');
                return;
            }

            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = '<div class="loading"><div class="spinner"></div>æœç´¢ä¸­...</div>';

            try {
                const response = await fetch('/api/rag/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        top_k: 5
                    })
                });

                const data = await response.json();
                
                // å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæ˜¾ç¤ºå®é™…ç»“æœï¼›å¦åˆ™æ˜¾ç¤ºå‡æ•°æ®
                const results = data.results || data.error ? getSearchMockData(query) : data.results;
                displaySearchResults(results);

            } catch (error) {
                // æ˜¾ç¤ºå‡æ•°æ®
                displaySearchResults(getSearchMockData(query));
            }
        }

        function getSearchMockData(query) {
            return [
                {
                    title: `å…³äº "${query}" çš„ Q1 æŠ¥å‘Š`,
                    content: `æœ¬æœŸ ${query} ç›¸å…³ä¸šåŠ¡æ•°æ®ç»Ÿè®¡ã€‚ç¬¬ä¸€å­£åº¦æ•´ä½“è¡¨ç°è‰¯å¥½ï¼Œé”€å”®é¢åŒæ¯”å¢é•¿ 15%ï¼Œå®¢æˆ·æ»¡æ„åº¦è¾¾åˆ° 92%ã€‚ä¸»è¦äº§å“çº¿é”€å”®ç¨³å®šå¢é•¿...`,
                    category: 'é”€å”®æŠ¥å‘Š',
                    similarity: 0.95
                },
                {
                    title: `${query} æ“ä½œæŒ‡å—`,
                    content: `${query} çš„è¯¦ç»†ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µã€‚æœ¬æ–‡æ¡£åŒ…å«å®Œæ•´çš„æ“ä½œæ­¥éª¤ã€å¸¸è§é—®é¢˜è§£ç­”å’Œæ•…éšœæ’é™¤æŒ‡å—ã€‚å»ºè®®æ‰€æœ‰ç”¨æˆ·é˜…è¯»...`,
                    category: 'ä¸šåŠ¡æµç¨‹',
                    similarity: 0.87
                },
                {
                    title: `${query} ç›¸å…³æ”¿ç­–æ–‡ä»¶`,
                    content: `å…¬å¸å…³äº ${query} çš„ç›¸å…³æ”¿ç­–å’Œåˆ¶åº¦è§„å®šã€‚æœ¬æ”¿ç­–è‡ª 2025 å¹´ 1 æœˆ 1 æ—¥èµ·æ‰§è¡Œï¼Œå¯¹æ‰€æœ‰éƒ¨é—¨å’Œå‘˜å·¥å‡æœ‰çº¦æŸåŠ›...`,
                    category: 'è§„èŒƒæ–‡æ¡£',
                    similarity: 0.78
                }
            ];
        }

        function displaySearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            
            if (!results || results.length === 0) {
                searchResults.innerHTML = '<p style="color: #999; text-align: center;">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</p>';
                return;
            }

            const html = results.map(r => `
                <div class="qa-item">
                    <div class="qa-question">${escapeHtml(r.title || '')}</div>
                    <div class="qa-answer">${escapeHtml(r.content || '').substring(0, 300)}...</div>
                    <div class="qa-meta">
                        ç±»åˆ«: ${escapeHtml(r.category || '-')} | ç›¸ä¼¼åº¦: ${(r.similarity || 0).toFixed(2)}
                    </div>
                </div>
            `).join('');
            
            searchResults.innerHTML = html;
        }

        // ==================== å·¥å…·å‡½æ•° ====================

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showAlert(message, type) {
            // åˆ›å»ºæç¤ºæ¡†
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type} show`;
            alertEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 400px;
                z-index: 10000;
                animation: slideDown 0.3s ease-out;
            `;
            alertEl.textContent = message;
            document.body.appendChild(alertEl);
            
            // 3 ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                alertEl.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => alertEl.remove(), 300);
            }, 3000);
            
            // åŒæ—¶è¾“å‡ºåˆ° console
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // ==================== å›è½¦äº‹ä»¶ç›‘å¬ ====================

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('questionInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    askQuestion();
                }
            });

            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchKnowledge();
                }
            });

            // åˆå§‹åŒ– LLM æ¨¡å‹åˆ—è¡¨
            refreshLLMModels();
        });

        // ==================== LLM æ¨¡å‹ç®¡ç†å‡½æ•° ====================

        // æ‰“å¼€å®Œæ•´ LLM æ¨¡å‹é…ç½®é¡µé¢
        function openLLMModelsPage() {
            window.open('llm_models.html', '_blank');
        }

        function switchLLMTab(tab) {
            document.getElementById('llm-list-tab').style.display = tab === 'list' ? 'block' : 'none';
            document.getElementById('llm-add-tab').style.display = tab === 'add' ? 'block' : 'none';
            
            if (tab === 'list') {
                // è¿”å›åˆ—è¡¨æ—¶æ¸…é™¤ç¼–è¾‘çŠ¶æ€
                window.currentEditingModelId = null;
                refreshLLMModels();
            } else if (tab === 'add') {
                // è¿›å…¥æ·»åŠ /ç¼–è¾‘æ ‡ç­¾æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®è®¾ç½®ç¼–è¾‘ IDï¼Œåˆ™æ¸…é™¤ç¼–è¾‘çŠ¶æ€
                // è¿™æ ·"æ·»åŠ æ–°æ¨¡å‹"æŒ‰é’®ä¼šè¿›å…¥åˆ›å»ºæ¨¡å¼
                if (!window.isEnteringEditMode) {
                    window.currentEditingModelId = null;
                    // é‡ç½®è¡¨å•
                    document.getElementById('llmName').value = '';
                    document.getElementById('llmProvider').value = '';
                    document.getElementById('llmType').value = 'api';
                    document.getElementById('llmEndpoint').value = '';
                    document.getElementById('llmApiKey').value = '';
                    document.getElementById('llmBaseUrl').value = '';
                    document.getElementById('llmMaxTokens').value = '2048';
                    document.getElementById('llmTemperature').value = '0.7';
                    document.getElementById('llmDescription').value = '';
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                    document.querySelector('button[onclick="saveLLMModel()"]').textContent = 'â• æ–°å¢æ¨¡å‹';
                }
                window.isEnteringEditMode = false;
            }
        }

        async function refreshLLMModels() {
            try {
                const response = await fetch('/api/llm/models/list');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayLLMModels(data.models);
                } else {
                    showAlert('åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('åŠ è½½æ¨¡å‹å¤±è´¥: ' + error.message, 'error');
            }
        }

        function displayLLMModels(models) {
            const container = document.getElementById('llmModelsContainer');
            
            if (models.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">è¿˜æ²¡æœ‰é…ç½®ä»»ä½•æ¨¡å‹ï¼Œè¯·æ·»åŠ ä¸€ä¸ª</div>';
                return;
            }

            container.innerHTML = models.map(model => `
                <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;" 
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.15)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <h4 style="margin: 0; color: #333;">${escapeHtml(model.name)}</h4>
                            ${model.is_default ? '<span style="background: #ed8936; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700;">â­ é»˜è®¤</span>' : ''}
                        </div>
                        <span style="background: ${model.enabled ? '#48bb78' : '#cbd5e0'}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                            ${model.enabled ? 'âœ“ å¯ç”¨' : 'âœ— ç¦ç”¨'}
                        </span>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <span style="color: #666; font-size: 13px;">
                            <strong>æä¾›å•†:</strong> ${escapeHtml(model.provider)}
                        </span>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <span style="color: #666; font-size: 13px;">
                            <strong>ç±»å‹:</strong> ${model.model_type === 'api' ? 'API æ¨¡å‹' : 'æœ¬åœ°æ¨¡å‹'}
                        </span>
                    </div>

                    ${model.endpoint ? `
                    <div style="margin-bottom: 12px;">
                        <span style="color: #666; font-size: 13px;">
                            <strong>ç«¯ç‚¹:</strong> ${escapeHtml(model.endpoint.substring(0, 50))}${model.endpoint.length > 50 ? '...' : ''}
                        </span>
                    </div>
                    ` : ''}

                    <div style="margin-bottom: 12px;">
                        <span style="color: #666; font-size: 13px;">
                            <strong>Token ä¸Šé™:</strong> ${model.max_tokens}
                        </span>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <span style="color: #666; font-size: 13px;">
                            <strong>Temperature:</strong> ${model.temperature}
                        </span>
                    </div>

                    ${model.description ? `
                    <div style="margin-bottom: 12px; padding: 10px; background: #f7fafc; border-radius: 5px;">
                        <span style="color: #666; font-size: 12px;">${escapeHtml(model.description)}</span>
                    </div>
                    ` : ''}

                    <div style="display: flex; gap: 8px; margin-top: 15px;">
                        <button class="btn" onclick="editLLMModel(${model.id})" style="flex: 1; padding: 8px; font-size: 12px; background: #667eea;">âœï¸ ç¼–è¾‘</button>
                        <button class="btn" onclick="setDefaultLLMModel(${model.id})" ${model.is_default ? 'disabled' : ''} style="flex: 1; padding: 8px; font-size: 12px; background: ${model.is_default ? '#ccc' : '#764ba2'}; cursor: ${model.is_default ? 'not-allowed' : 'pointer'};">${model.is_default ? 'âœ“ å·²æ˜¯é»˜è®¤' : 'â­ è®¾ä¸ºé»˜è®¤'}</button>
                        <button class="btn" onclick="deleteLLMModel(${model.id})" style="flex: 1; padding: 8px; font-size: 12px; background: #f56565;">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        async function saveLLMModel() {
            // å®‰å…¨è·å–è¡¨å•å…ƒç´ å€¼ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨åˆ™è¿”å›é»˜è®¤å€¼
            const getElementValue = (id, defaultVal = '') => {
                const elem = document.getElementById(id);
                const val = elem ? elem.value : defaultVal;
                console.log(`[FORM] Getting ${id}: "${val}" (type: ${typeof val}, length: ${val ? val.length : 0})`);
                return val;
            };
            
            console.log('[SAVE START] saveLLMModel called at', new Date().toLocaleTimeString());
            
            const name = getElementValue('llmName', '').trim();
            const provider = getElementValue('llmProvider', '');
            const modelType = getElementValue('llmType', 'api');
            const endpoint = getElementValue('llmEndpoint', '').trim();
            const apiKey = getElementValue('llmApiKey', '').trim();
            const baseUrl = getElementValue('llmBaseUrl', '').trim();
            
            // å®‰å…¨è§£ææ•°å€¼ï¼Œå¤„ç† NaN æƒ…å†µ
            const maxTokensStr = getElementValue('llmMaxTokens', '2048');
            const maxTokens = parseInt(maxTokensStr);
            const temperatureStr = getElementValue('llmTemperature', '0.7');
            const temperature = parseFloat(temperatureStr);
            
            const description = getElementValue('llmDescription', '').trim();

            console.log('[LLM Debug] Raw form values:', {
                name, provider, modelType, endpoint, apiKey, baseUrl, maxTokens, temperature, description,
                currentEditingModelId: window.currentEditingModelId,
                maxTokensType: typeof maxTokens,
                temperatureType: typeof temperature,
                maxTokensValue: maxTokens,
                temperatureValue: temperature,
                isNaN_maxTokens: isNaN(maxTokens),
                isNaN_temperature: isNaN(temperature)
            });

            if (!name || !provider) {
                showAlert('è¯·å¡«å†™å¿…å¡«å­—æ®µ', 'error');
                return;
            }

            try {
                // åˆ¤æ–­æ˜¯ç¼–è¾‘è¿˜æ˜¯åˆ›å»ºï¼ˆä½¿ç”¨ä¸¥æ ¼çš„ null/undefined æ£€æŸ¥ï¼‰
                const isEditing = window.currentEditingModelId != null;
                const modelId = isEditing ? parseInt(window.currentEditingModelId) : null;
                
                // éªŒè¯ modelId æ˜¯æœ‰æ•ˆçš„æ•´æ•°
                if (isEditing && isNaN(modelId)) {
                    showAlert('é”™è¯¯ï¼šæ— æ•ˆçš„æ¨¡å‹ ID', 'error');
                    console.error('[LLM Error] Invalid modelId:', window.currentEditingModelId);
                    return;
                }
                
                const method = isEditing ? 'PUT' : 'POST';
                const url = isEditing ? `/api/llm/models/${modelId}` : '/api/llm/models';
                console.log('[LLM Debug] Operation mode:', {isEditing, modelId, method, url});
                
                // æ£€æŸ¥ URL æ˜¯å¦åŒ…å« undefined
                if (url.includes('undefined')) {
                    showAlert('é”™è¯¯ï¼šæ¨¡å‹ ID æ— æ•ˆï¼Œè¯·é‡æ–°åŠ è½½é¡µé¢', 'error');
                    return;
                }

                // æ„å»ºè¯·æ±‚æ•°æ®
                let requestData = {};
                
                if (isEditing) {
                    // ç¼–è¾‘æ¨¡å¼ï¼šåªå‘é€ä¿®æ”¹è¿‡çš„å­—æ®µï¼ˆä¸å‘é€åç§°ï¼Œå› ä¸ºåç§°æ˜¯å”¯ä¸€çš„ï¼‰
                    console.log('[BUILD DATA] Edit mode - building partial update');
                    if (provider) {
                        requestData.provider = provider;
                        console.log('[BUILD DATA] Added provider:', provider);
                    }
                    if (modelType) {
                        requestData.model_type = modelType;
                        console.log('[BUILD DATA] Added model_type:', modelType);
                    }
                    // å¯¹äºæ•°å€¼å­—æ®µï¼Œæ£€æŸ¥ä¸æ˜¯ NaNï¼ˆä½†å…è®¸ 0ï¼‰
                    if (!isNaN(maxTokens)) {
                        requestData.max_tokens = maxTokens;
                        console.log('[BUILD DATA] Added max_tokens:', maxTokens);
                    } else {
                        console.log('[BUILD DATA] Skipped max_tokens - isNaN:', true);
                    }
                    if (!isNaN(temperature)) {
                        requestData.temperature = temperature;
                        console.log('[BUILD DATA] Added temperature:', temperature);
                    } else {
                        console.log('[BUILD DATA] Skipped temperature - isNaN:', true);
                    }
                    if (endpoint) {
                        requestData.endpoint = endpoint;
                        console.log('[BUILD DATA] Added endpoint:', endpoint);
                    }
                    if (apiKey) {
                        requestData.api_key = apiKey;
                        console.log('[BUILD DATA] Added api_key (length):', apiKey.length);
                    }
                    if (baseUrl) {
                        requestData.base_url = baseUrl;
                        console.log('[BUILD DATA] Added base_url:', baseUrl);
                    }
                    if (description) {
                        requestData.description = description;
                        console.log('[BUILD DATA] Added description:', description);
                    }
                } else {
                    // åˆ›å»ºæ¨¡å¼ï¼šå‘é€æ‰€æœ‰å¿…éœ€å­—æ®µ
                    console.log('[BUILD DATA] Create mode - building full request');
                    requestData = {
                        name, 
                        provider, 
                        model_type: modelType
                    };
                    console.log('[BUILD DATA] Added required fields: name, provider, model_type');
                    
                    // æ·»åŠ å¯é€‰å­—æ®µ
                    if (!isNaN(maxTokens)) {
                        requestData.max_tokens = maxTokens;
                        console.log('[BUILD DATA] Added max_tokens:', maxTokens);
                    }
                    if (!isNaN(temperature)) {
                        requestData.temperature = temperature;
                        console.log('[BUILD DATA] Added temperature:', temperature);
                    }
                    if (endpoint) {
                        requestData.endpoint = endpoint;
                        console.log('[BUILD DATA] Added endpoint:', endpoint);
                    }
                    if (apiKey) {
                        requestData.api_key = apiKey;
                        console.log('[BUILD DATA] Added api_key (length):', apiKey.length);
                    }
                    if (baseUrl) {
                        requestData.base_url = baseUrl;
                        console.log('[BUILD DATA] Added base_url:', baseUrl);
                    }
                    if (description) {
                        requestData.description = description;
                        console.log('[BUILD DATA] Added description:', description);
                    }
                }

                console.log('[BUILD DATA] Final requestData object:', requestData);
                console.log('[BUILD DATA] Final requestData keys:', Object.keys(requestData));

                const requestBody = JSON.stringify(requestData);
                console.log('[FETCH] About to send:', {method, url, bodyLength: requestBody.length});
                console.log('[FETCH] Full request body:', requestBody);

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: requestBody
                });
                
                console.log('[LLM Debug] Response status:', response.status, response.statusText);

                const data = await response.json();
                
                // è¯¦ç»†è®°å½•å“åº”æ•°æ®ï¼ˆç”¨äºè°ƒè¯•ï¼‰
                console.log('[LLM Debug] Response data:', JSON.stringify(data));
                
                if (response.status === 200 && data.status === 'success') {
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    const successMessage = isEditing ? 'âœ… æ¨¡å‹å·²æ›´æ–°æˆåŠŸï¼' : 'âœ… æ¨¡å‹å·²ä¿å­˜æˆåŠŸï¼';
                    showAlert(successMessage, 'success');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('llmName').value = '';
                    document.getElementById('llmProvider').value = '';
                    document.getElementById('llmType').value = 'api';
                    document.getElementById('llmEndpoint').value = '';
                    document.getElementById('llmApiKey').value = '';
                    document.getElementById('llmBaseUrl').value = '';
                    document.getElementById('llmMaxTokens').value = '2048';
                    document.getElementById('llmTemperature').value = '0.7';
                    document.getElementById('llmDescription').value = '';
                    
                    // æ¸…é™¤ç¼–è¾‘çŠ¶æ€
                    window.currentEditingModelId = null;
                    document.querySelector('button[onclick="saveLLMModel()"]').textContent = 'ğŸ’¾ ä¿å­˜æ¨¡å‹';
                    
                    // å»¶è¿Ÿ 1.5 ç§’åè‡ªåŠ¨è¿”å›åˆ—è¡¨è§†å›¾
                    setTimeout(() => {
                        switchLLMTab('list');
                    }, 1500);
                } else if (response.status === 422) {
                    // 422 Unprocessable Entity - Pydantic éªŒè¯é”™è¯¯
                    let errorMsg = 'æ•°æ®éªŒè¯å¤±è´¥ï¼š';
                    if (Array.isArray(data.detail)) {
                        errorMsg += data.detail.map(err => `${err.loc ? err.loc.join('.') : 'å­—æ®µ'}: ${err.msg}`).join('; ');
                    } else if (typeof data.detail === 'string') {
                        errorMsg += data.detail;
                    } else {
                        errorMsg += JSON.stringify(data.detail);
                    }
                    console.error('[LLM Error] Validation error:', errorMsg);
                    showAlert(errorMsg, 'error');
                } else {
                    // å…¶ä»–é”™è¯¯
                    let errorMsg = data.detail || data.message || 'ä¿å­˜æ¨¡å‹å¤±è´¥';
                    if (Array.isArray(errorMsg)) {
                        errorMsg = errorMsg.join('; ');
                    }
                    showAlert(errorMsg, 'error');
                }
            } catch (error) {
                console.error('[LLM Error] Exception caught:', error);
                showAlert('ä¿å­˜æ¨¡å‹å¤±è´¥: ' + (error.message || JSON.stringify(error)), 'error');
            }
        }

        async function setDefaultLLMModel(modelId) {
            try {
                const response = await fetch(`/api/llm/models/${modelId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_default: 1 })
                });

                const data = await response.json();
                if (data.status === 'success') {
                    showAlert('å·²è®¾ç½®ä¸ºé»˜è®¤æ¨¡å‹', 'success');
                    refreshLLMModels();
                } else {
                    showAlert(data.detail || 'è®¾ç½®å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('è®¾ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function deleteLLMModel(modelId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡å‹å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`/api/llm/models/${modelId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.status === 'success') {
                    showAlert('æ¨¡å‹å·²åˆ é™¤', 'success');
                    refreshLLMModels();
                } else {
                    showAlert(data.detail || 'åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function exportLLMData() {
            try {
                const response = await fetch('/api/data/export');
                const data = await response.json();
                
                if (data.status === 'success') {
                    const json = JSON.stringify(data.data, null, 2);
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `llm-config-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    showAlert('é…ç½®å¯¼å‡ºæˆåŠŸ', 'success');
                } else {
                    showAlert('å¯¼å‡ºå¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function editLLMModel(modelId) {
            try {
                console.log('[EditLLM] Starting to edit model ID:', modelId);
                // è·å–æ¨¡å‹è¯¦æƒ…
                const response = await fetch(`/api/llm/models/${modelId}`);
                console.log('[EditLLM] Fetch response status:', response.status);
                
                const data = await response.json();
                console.log('[EditLLM] Response data:', data);
                
                if (data.status === 'success') {
                    const model = data.model;
                    console.log('[EditLLM] Model data:', model);
                    
                    // å¡«å……è¡¨å•
                    document.getElementById('llmName').value = model.name;
                    document.getElementById('llmProvider').value = model.provider;
                    document.getElementById('llmType').value = model.model_type || 'api';
                    document.getElementById('llmEndpoint').value = model.endpoint || '';
                    document.getElementById('llmApiKey').value = model.api_key || '';
                    document.getElementById('llmBaseUrl').value = model.base_url || '';
                    document.getElementById('llmMaxTokens').value = model.max_tokens || '2048';
                    document.getElementById('llmTemperature').value = model.temperature || '0.7';
                    document.getElementById('llmDescription').value = model.description || '';
                    
                    console.log('[EditLLM] Form fields populated');
                    
                    // è®¾ç½®ç¼–è¾‘çŠ¶æ€
                    window.currentEditingModelId = modelId;
                    window.isEnteringEditMode = true;  // æ ‡è®°ä¸ºè¿›å…¥ç¼–è¾‘æ¨¡å¼
                    console.log('[EditLLM] Set editing mode:', {modelId, isEnteringEditMode: window.isEnteringEditMode});
                    
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                    document.querySelector('button[onclick="saveLLMModel()"]').textContent = 'ğŸ’¾ æ›´æ–°æ¨¡å‹';
                    
                    // åˆ‡æ¢åˆ°ç¼–è¾‘æ ‡ç­¾
                    switchLLMTab('add');
                    showAlert('å·²åŠ è½½æ¨¡å‹ä¿¡æ¯ï¼Œè¯·ä¿®æ”¹åä¿å­˜', 'info');
                } else {
                    console.error('[EditLLM] Error: status is not success', data);
                    showAlert('è·å–æ¨¡å‹ä¿¡æ¯å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('[EditLLM] Exception:', error);
                showAlert('è·å–æ¨¡å‹å¤±è´¥: ' + error.message, 'error');
            }
        }
    </script>

</body>
</html>
