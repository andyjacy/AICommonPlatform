<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>AI Common Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #232342;
            --bg-tertiary: #2d2d4a;
            --bg-elevated: #363658;
            --bg-hover: #3f3f66;
            --border-color: #4a4a70;
            --border-hover: #5a5a88;
            --text-primary: #ffffff;
            --text-secondary: #c8c8e0;
            --text-muted: #9898b8;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-success: #34d399;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Loading Mask */
        #loadingMask {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity var(--transition-slow);
        }

        #loadingMask.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loader-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Navbar */
        .navbar {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 40px;
            text-decoration: none;
        }

        .navbar-brand svg {
            width: 28px;
            height: 28px;
        }

        .nav-menu {
            display: flex;
            gap: 4px;
            flex: 1;
            list-style: none;
        }

        .nav-item {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .nav-item.active {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .nav-item svg {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        .nav-item.active svg,
        .nav-item:hover svg {
            opacity: 1;
        }

        /* Language Switcher */
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }

        .language-switcher {
            display: flex;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 2px;
            border: 1px solid var(--border-color);
        }

        .language-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all var(--transition-fast);
        }

        .language-btn:hover {
            color: var(--text-primary);
        }

        .language-btn.active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 32px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* Layout */
        .layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: all var(--transition-normal);
        }

        .card:hover {
            border-color: var(--border-hover);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title svg {
            width: 18px;
            height: 18px;
            color: var(--accent-primary);
        }

        /* Main Content */
        .main-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Input Group */
        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .input-wrapper svg {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--text-muted);
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            padding-left: 44px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-family: inherit;
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        input[type="text"]::placeholder,
        textarea::placeholder {
            color: var(--text-muted);
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            background: var(--text-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            font-family: inherit;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--border-hover);
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* Checkbox */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            cursor: pointer;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-primary);
            cursor: pointer;
        }

        .checkbox-wrapper span {
            font-size: 14px;
            color: var(--text-secondary);
            user-select: none;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
        }

        .tab-btn {
            padding: 10px 16px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
            transition: all var(--transition-fast);
            border-radius: var(--radius-md);
            position: relative;
        }

        .tab-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-tertiary);
        }

        .tab-btn.active {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -13px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 2px;
            background: var(--accent-primary);
            border-radius: 2px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width var(--transition-normal);
            border-radius: 4px;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
        }

        /* QA Item */
        .qa-item {
            background: var(--bg-tertiary);
            padding: 20px;
            margin-bottom: 16px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .qa-item:hover {
            border-color: var(--border-hover);
        }

        .qa-question {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .qa-question::before {
            content: 'Q';
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            background: var(--accent-primary);
            color: white;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .qa-answer {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 14px;
            padding-left: 32px;
            margin-bottom: 16px;
        }

        .qa-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-left: 32px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .qa-meta .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-hover);
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .qa-meta .badge-success {
            color: var(--accent-success);
        }

        /* Status Card */
        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-success);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-info {
            flex: 1;
        }

        .status-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .status-desc {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* System Info Card */
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 13px;
            color: var(--text-muted);
        }

        .info-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Grid Layout for Cards */
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .feature-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: all var(--transition-normal);
            cursor: default;
        }

        .feature-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 24px;
        }

        .feature-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .feature-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            color: var(--accent-primary);
            margin-top: 12px;
        }

        /* Integration Card */
        .integration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .integration-btn {
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
        }

        .integration-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .integration-btn .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .integration-btn .label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* LLM Model Card */
        .model-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            transition: all var(--transition-fast);
        }

        .model-card:hover {
            border-color: var(--border-hover);
        }

        .model-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .model-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .model-badges {
            display: flex;
            gap: 8px;
        }

        .model-badge {
            padding: 4px 8px;
            background: var(--bg-hover);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
        }

        .model-badge.default {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-primary);
        }

        .model-badge.enabled {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-success);
        }

        .model-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .model-detail {
            font-size: 12px;
        }

        .model-detail-label {
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .model-detail-value {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Trace Timeline */
        .trace-timeline {
            position: relative;
            padding-left: 24px;
        }

        .trace-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .trace-step {
            position: relative;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
        }

        .trace-step::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border-radius: 50%;
            border: 2px solid var(--bg-secondary);
        }

        .trace-step.success::before {
            background: var(--accent-success);
        }

        .trace-step.error::before {
            background: var(--accent-danger);
        }

        .trace-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .trace-stage {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .trace-service {
            font-size: 11px;
            color: var(--text-muted);
            padding: 2px 8px;
            background: var(--bg-hover);
            border-radius: var(--radius-sm);
        }

        .trace-purpose {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .sidebar .card {
                flex: 1;
                min-width: 280px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 16px;
            }

            .nav-menu {
                display: none;
            }

            .container {
                padding: 20px 16px;
            }

            .page-header h1 {
                font-size: 24px;
            }

            .input-group {
                flex-direction: column;
            }

            .grid-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Mobile Nav Menu */
        .mobile-menu-btn {
            display: none;
            padding: 8px;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
                margin-right: 12px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-hover);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }

        /* Search Results */
        .search-result {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
            transition: all var(--transition-fast);
        }

        .search-result:hover {
            border-color: var(--border-hover);
        }

        .search-result-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .search-result-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .search-result-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .search-result-meta .tag {
            padding: 2px 8px;
            background: var(--bg-hover);
            border-radius: var(--radius-sm);
        }

        /* Connected System */
        .system-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
        }

        .system-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .system-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--accent-success);
            font-weight: 500;
        }

        .system-desc {
            font-size: 12px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Loading Mask -->
    <div id="loadingMask">
        <div class="loader">
            <div class="loader-spinner"></div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <a href="#" class="navbar-brand">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            AI Platform
        </a>
        <ul class="nav-menu">
            <li class="nav-item active" data-page="qa">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                <span data-i18n="navbar.qa">Q&A Center</span>
            </li>
            <li class="nav-item" data-page="prompt">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                <span data-i18n="navbar.prompt">Prompts</span>
            </li>
            <li class="nav-item" data-page="rag">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                <span data-i18n="navbar.rag">Knowledge</span>
            </li>
            <li class="nav-item" data-page="integration">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                <span data-i18n="navbar.integration">Integration</span>
            </li>
            <li class="nav-item" data-page="llm">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 2a10 10 0 0 1 10 10"></path><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                <span data-i18n="navbar.llm">LLM Models</span>
            </li>
            <li class="nav-item" data-page="monitor">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                <span data-i18n="navbar.monitor">Monitor</span>
            </li>
        </ul>
        <div class="nav-actions">
            <div class="language-switcher">
                <button class="language-btn active" data-lang="zh" onclick="setLanguage('zh')">CN</button>
                <button class="language-btn" data-lang="en" onclick="setLanguage('en')">EN</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Q&A Page -->
        <div class="page active" data-page-id="qa">
            <div class="page-header">
                <h1 data-i18n="qa.title">Q&A Center</h1>
                <p data-i18n="qa.subtitle">Ask questions and get intelligent AI-powered answers</p>
            </div>

            <div class="layout">
                <div class="main-content">
                    <div class="input-group">
                        <div class="input-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            <input type="text" id="questionInput" data-i18n-placeholder="qa.placeholder" placeholder="Enter your question...">
                        </div>
                        <button class="btn" id="askBtn" onclick="askQuestion()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            <span data-i18n="qa.ask">Ask</span>
                        </button>
                    </div>

                    <div id="progressContainer" class="progress-container" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                        </div>
                        <div class="progress-text" id="progressText">Processing: 0%</div>
                    </div>

                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="enableTrace">
                        <span data-i18n="qa.enableTrace">Show call chain trace</span>
                    </label>

                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab(event, 'history')" data-i18n="qa.history">History</button>
                        <button class="tab-btn" onclick="switchTab(event, 'trace')" data-i18n="qa.trace">Trace</button>
                    </div>

                    <div id="history-tab" class="tab-content active">
                        <div id="responseArea">
                            <div class="empty-state">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                <p data-i18n="qa.emptyHistory">Your answers will appear here after asking</p>
                            </div>
                        </div>
                    </div>

                    <div id="trace-tab" class="tab-content">
                        <div id="traceArea">
                            <div class="empty-state">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                                <p data-i18n="qa.emptyTrace">Enable "Show call chain trace" to see the processing flow</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                <span data-i18n="qa.serviceStatus">Service Status</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-dot"></div>
                            <div class="status-info">
                                <div class="status-name" data-i18n="qa.allOnline">All services online</div>
                                <div class="status-desc">7 services running</div>
                            </div>
                        </div>
                    </div>


                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                                <span data-i18n="qa.systemInfo">System Info</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label" data-i18n="qa.version">Version</span>
                            <span class="info-value">2.1.0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label" data-i18n="qa.environment">Environment</span>
                            <span class="info-value">Lite</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label" data-i18n="qa.model">Model</span>
                            <span class="info-value">GPT-3.5</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Page -->
        <div class="page" data-page-id="prompt">
            <div class="page-header">
                <h1 data-i18n="prompt.title">Prompt Management</h1>
                <p data-i18n="prompt.subtitle">View and manage AI assistant role configurations</p>
            </div>
            <div id="promptContainer">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                    <p data-i18n="common.loading">Loading...</p>
                </div>
            </div>
        </div>

        <!-- RAG Page -->
        <div class="page" data-page-id="rag">
            <div class="page-header">
                <h1 data-i18n="rag.title">Knowledge Base</h1>
                <p data-i18n="rag.subtitle">Enterprise knowledge base with document search and retrieval</p>
            </div>
            <div class="card">
                <div class="input-group">
                    <div class="input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="ragSearchInput" data-i18n-placeholder="rag.searchPlaceholder" placeholder="Search documents...">
                    </div>
                    <button class="btn" onclick="searchRagDocuments()" data-i18n="rag.searchBtn">Search</button>
                </div>
                <div id="ragResults">
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                        <p data-i18n="rag.emptyResults">Enter keywords to search the knowledge base</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integration Page -->
        <div class="page" data-page-id="integration">
            <div class="page-header">
                <h1 data-i18n="integration.title">System Integration</h1>
                <p data-i18n="integration.subtitle">Enterprise system knowledge base and intelligent queries</p>
            </div>
            
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <div class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <span data-i18n="integration.searchTitle">Enterprise Knowledge Search</span>
                    </div>
                </div>
                <div class="input-group">
                    <div class="input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="integrationSearchInput" data-i18n-placeholder="integration.searchPlaceholder" placeholder="Search enterprise knowledge...">
                    </div>
                    <button class="btn" onclick="searchIntegrationKnowledge()" data-i18n="integration.searchBtn">Search</button>
                </div>
                <div id="integrationResults"></div>
            </div>
            
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <div class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                        <span data-i18n="integration.categories">Browse by Category</span>
                    </div>
                </div>
                <div class="integration-grid">
                    <button class="integration-btn" onclick="searchIntegrationByCategory('sales')">
                        <div class="icon">Sales</div>
                        <div class="label" data-i18n="integration.sales">Sales Dept</div>
                    </button>
                    <button class="integration-btn" onclick="searchIntegrationByCategory('hr')">
                        <div class="icon">HR</div>
                        <div class="label" data-i18n="integration.hr">Human Resources</div>
                    </button>
                    <button class="integration-btn" onclick="searchIntegrationByCategory('finance')">
                        <div class="icon">FIN</div>
                        <div class="label" data-i18n="integration.finance">Finance</div>
                    </button>
                    <button class="integration-btn" onclick="searchIntegrationByCategory('technical')">
                        <div class="icon">TECH</div>
                        <div class="label" data-i18n="integration.technical">Technical</div>
                    </button>
                    <button class="integration-btn" onclick="searchIntegrationByCategory('supply_chain')">
                        <div class="icon">SCM</div>
                        <div class="label" data-i18n="integration.supplyChain">Supply Chain</div>
                    </button>
                    <button class="integration-btn" onclick="searchIntegrationByCategory('marketing')">
                        <div class="icon">MKT</div>
                        <div class="label" data-i18n="integration.marketing">Marketing</div>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        <span data-i18n="integration.connectedSystems">Connected Systems</span>
                    </div>
                </div>
                <div id="systemStatusContainer">
                    <div class="system-card">
                        <div class="system-header">
                            <span class="system-name">ERP System</span>
                            <span class="system-status">
                                <span class="status-dot"></span>
                                Connected
                            </span>
                        </div>
                        <div class="system-desc">Sales, Inventory, Procurement | PostgreSQL | Real-time</div>
                    </div>
                    <div class="system-card">
                        <div class="system-header">
                            <span class="system-name">HR System</span>
                            <span class="system-status">
                                <span class="status-dot"></span>
                                Connected
                            </span>
                        </div>
                        <div class="system-desc">Employees, Payroll, Performance | PostgreSQL | Daily</div>
                    </div>
                    <div class="system-card">
                        <div class="system-header">
                            <span class="system-name">Finance System</span>
                            <span class="system-status">
                                <span class="status-dot"></span>
                                Connected
                            </span>
                        </div>
                        <div class="system-desc">Budget, Accounting, Reports | SAP | Weekly</div>
                    </div>
                    <div class="system-card">
                        <div class="system-header">
                            <span class="system-name">CRM System</span>
                            <span class="system-status">
                                <span class="status-dot"></span>
                                Connected
                            </span>
                        </div>
                        <div class="system-desc">Customer Info, Sales Opportunities | REST API | Real-time</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LLM Page -->
        <div class="page" data-page-id="llm">
            <div class="page-header">
                <h1 data-i18n="llm.title">LLM Models</h1>
                <p data-i18n="llm.subtitle">Configure and manage AI large language model interfaces</p>
            </div>
            <div id="llmContainer">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 2a10 10 0 0 1 10 10"></path></svg>
                    <p data-i18n="common.loading">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Monitor Page -->
        <div class="page" data-page-id="monitor">
            <div class="page-header">
                <h1 data-i18n="monitor.title">Monitor Panel</h1>
                <p data-i18n="monitor.subtitle">Real-time system monitoring and performance statistics</p>
            </div>
            
            <!-- 概览统计卡片 -->
            <div class="monitor-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="card stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #818cf8);">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalQuestions">-</div>
                        <div class="stat-label" data-i18n="monitor.totalQuestions">Total Questions</div>
                        <div class="stat-sub" id="todayQuestions">Today: -</div>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #34d399, #6ee7b7);">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalRag">-</div>
                        <div class="stat-label" data-i18n="monitor.ragQueries">RAG Queries</div>
                        <div class="stat-sub" id="todayRag">Today: -</div>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M20 12a8 8 0 0 0-8-8v8h8z"></path></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalTokens">-</div>
                        <div class="stat-label" data-i18n="monitor.tokenUsage">Token Usage</div>
                        <div class="stat-sub" id="todayTokens">Today: -</div>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #ec4899, #f472b6);">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="avgResponseTime">-</div>
                        <div class="stat-label" data-i18n="monitor.avgResponse">Avg Response</div>
                        <div class="stat-sub" id="avgConfidence">Confidence: -</div>
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 24px;">
                <!-- Prompt使用统计 -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                            <span data-i18n="monitor.promptUsage">Prompt Usage Statistics</span>
                        </div>
                    </div>
                    <div id="promptUsageContainer" style="padding: 16px;">
                        <div class="empty-state" style="padding: 20px;">
                            <p>Loading...</p>
                        </div>
                    </div>
                </div>
                
                <!-- 部门数据使用统计 -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                            <span data-i18n="monitor.deptUsage">Department Data Usage</span>
                        </div>
                    </div>
                    <div id="deptUsageContainer" style="padding: 16px;">
                        <div class="empty-state" style="padding: 20px;">
                            <p>Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 7天趋势图 -->
            <div class="card" style="margin-top: 24px;">
                <div class="card-header">
                    <div class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                        <span data-i18n="monitor.weeklyTrend">Weekly Question Trend</span>
                    </div>
                </div>
                <div id="trendContainer" style="padding: 16px;">
                    <div class="trend-chart" style="display: flex; align-items: flex-end; gap: 8px; height: 150px; padding: 16px 0;">
                        <!-- 将由JS填充 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Monitor Page Styles */
        .stat-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .stat-sub {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .usage-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .usage-item:last-child {
            border-bottom: none;
        }
        
        .usage-name {
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .usage-bar-container {
            flex: 1;
            margin: 0 16px;
            height: 8px;
            background: var(--bg-hover);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .usage-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .usage-count {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 50px;
            text-align: right;
        }
        
        .trend-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px 4px 0 0;
            min-height: 10px;
            position: relative;
            transition: height 0.5s ease;
        }
        
        .trend-bar:hover {
            opacity: 0.8;
        }
        
        .trend-bar .trend-label {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-muted);
            white-space: nowrap;
        }
        
        .trend-bar .trend-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }
    </style>

    <script>
        // ==================== i18n System ====================
        const i18n = {
            zh: {
                'navbar.qa': '问答中心',
                'navbar.prompt': 'Prompt',
                'navbar.rag': '知识库',
                'navbar.integration': '系统集成',
                'navbar.llm': '大模型',
                'navbar.monitor': '监控',
                'qa.title': '问答中心',
                'qa.subtitle': '输入问题，AI 将为您提供智能回答',
                'qa.placeholder': '输入您的问题...',
                'qa.ask': '提问',
                'qa.enableTrace': '显示调用链追踪',
                'qa.history': '历史记录',
                'qa.search': '知识搜索',
                'qa.trace': '调用链',
                'qa.emptyHistory': '提问后，回答将显示在这里',
                'qa.emptySearch': '搜索结果将显示在这里',
                'qa.emptyTrace': '勾选"显示调用链追踪"后查看处理流程',
                'qa.serviceStatus': '服务状态',
                'qa.allOnline': '所有服务在线',
                'qa.systemInfo': '系统信息',
                'qa.version': '版本',
                'qa.environment': '环境',
                'qa.model': '模型',
                'qa.confidence': '置信度',
                'qa.duration': '耗时',
                'qa.viewTrace': '查看调用链',
                'prompt.title': 'Prompt 管理',
                'prompt.subtitle': '查看和管理 AI 助手角色配置',
                'rag.title': '知识库',
                'rag.subtitle': '企业内部知识库，支持文档搜索和检索',
                'rag.searchPlaceholder': '搜索知识库文档...',
                'rag.searchBtn': '搜索',
                'rag.emptyResults': '输入关键词搜索知识库',
                'integration.title': '系统集成',
                'integration.subtitle': '企业各类系统的知识库展示和智能查询',
                'integration.searchTitle': '企业知识搜索',
                'integration.searchPlaceholder': '搜索企业知识库...',
                'integration.searchBtn': '搜索',
                'integration.categories': '按业务分类浏览',
                'integration.sales': '销售部门',
                'integration.hr': '人力资源',
                'integration.finance': '财务部门',
                'integration.technical': '技术部门',
                'integration.supplyChain': '供应链',
                'integration.marketing': '市场营销',
                'integration.connectedSystems': '已连接系统',
                'llm.title': '大模型管理',
                'llm.subtitle': '配置、管理和选择 AI 大模型接口',
                'llm.provider': '提供商',
                'llm.maxTokens': '最大Token',
                'llm.temperature': '温度',
                'llm.default': '默认',
                'llm.enabled': '已启用',
                'monitor.title': '监控面板',
                'monitor.subtitle': '系统实时监控和性能统计',
                'monitor.totalQuestions': '总提问次数',
                'monitor.ragQueries': 'RAG查询次数',
                'monitor.tokenUsage': 'Token消耗量',
                'monitor.avgResponse': '平均响应时间',
                'monitor.promptUsage': 'Prompt使用统计',
                'monitor.deptUsage': '部门数据使用统计',
                'monitor.weeklyTrend': '近7天提问趋势',
                'common.loading': '加载中...',
                'common.noData': '暂无数据'
            },
            en: {
                'navbar.qa': 'Q&A Center',
                'navbar.prompt': 'Prompts',
                'navbar.rag': 'Knowledge',
                'navbar.integration': 'Integration',
                'navbar.llm': 'LLM Models',
                'navbar.monitor': 'Monitor',
                'qa.title': 'Q&A Center',
                'qa.subtitle': 'Ask questions and get intelligent AI-powered answers',
                'qa.placeholder': 'Enter your question...',
                'qa.ask': 'Ask',
                'qa.enableTrace': 'Show call chain trace',
                'qa.history': 'History',
                'qa.search': 'Search',
                'qa.trace': 'Trace',
                'qa.emptyHistory': 'Your answers will appear here after asking',
                'qa.emptySearch': 'Search results will appear here',
                'qa.emptyTrace': 'Enable "Show call chain trace" to see the processing flow',
                'qa.serviceStatus': 'Service Status',
                'qa.allOnline': 'All services online',
                'qa.systemInfo': 'System Info',
                'qa.version': 'Version',
                'qa.environment': 'Environment',
                'qa.model': 'Model',
                'qa.confidence': 'Confidence',
                'qa.duration': 'Duration',
                'qa.viewTrace': 'View Trace',
                'prompt.title': 'Prompt Management',
                'prompt.subtitle': 'View and manage AI assistant role configurations',
                'rag.title': 'Knowledge Base',
                'rag.subtitle': 'Enterprise knowledge base with document search and retrieval',
                'rag.searchPlaceholder': 'Search documents...',
                'rag.searchBtn': 'Search',
                'rag.emptyResults': 'Enter keywords to search the knowledge base',
                'integration.title': 'System Integration',
                'integration.subtitle': 'Enterprise system knowledge base and intelligent queries',
                'integration.searchTitle': 'Enterprise Knowledge Search',
                'integration.searchPlaceholder': 'Search enterprise knowledge...',
                'integration.searchBtn': 'Search',
                'integration.categories': 'Browse by Category',
                'integration.sales': 'Sales Dept',
                'integration.hr': 'Human Resources',
                'integration.finance': 'Finance',
                'integration.technical': 'Technical',
                'integration.supplyChain': 'Supply Chain',
                'integration.marketing': 'Marketing',
                'integration.connectedSystems': 'Connected Systems',
                'llm.title': 'LLM Models',
                'llm.subtitle': 'Configure and manage AI large language model interfaces',
                'llm.provider': 'Provider',
                'llm.maxTokens': 'Max Tokens',
                'llm.temperature': 'Temperature',
                'llm.default': 'Default',
                'llm.enabled': 'Enabled',
                'monitor.title': 'Monitor Panel',
                'monitor.subtitle': 'Real-time system monitoring and performance statistics',
                'monitor.totalQuestions': 'Total Questions',
                'monitor.ragQueries': 'RAG Queries',
                'monitor.tokenUsage': 'Token Usage',
                'monitor.avgResponse': 'Avg Response Time',
                'monitor.promptUsage': 'Prompt Usage Statistics',
                'monitor.deptUsage': 'Department Data Usage',
                'monitor.weeklyTrend': 'Weekly Question Trend',
                'common.loading': 'Loading...',
                'common.noData': 'No data'
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'zh';

        function t(key) {
            return i18n[currentLanguage]?.[key] || i18n['en'][key] || key;
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            updatePageLanguage();
            
            // 重新渲染需要翻译的动态内容
            loadPrompts();  // 重新加载Prompts以应用翻译
            
            // 如果当前在Monitor页面，重新加载统计数据
            const monitorPage = document.querySelector('[data-page-id="monitor"]');
            if (monitorPage && monitorPage.classList.contains('active')) {
                loadMonitorStatistics();
            }
        }

        function updatePageLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });
            
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLanguage);
            });
        }

        // ==================== Initialize ====================
        
        function hideLoadingMask() {
            const mask = document.getElementById('loadingMask');
            if (mask) {
                mask.classList.add('hidden');
                setTimeout(() => mask.remove(), 350);
            }
        }

        window.currentTraceData = null;
        window.isAnswering = false;

        async function loadInitialData() {
            try {
                await Promise.all([loadQAHistory(), loadPrompts()]);
            } catch (error) {
                console.error('Failed to load initial data:', error);
            }
        }

        // ==================== Q&A History ====================
        
        async function loadQAHistory() {
            try {
                const response = await fetch('/api/qa/history/all');
                const data = await response.json();
                
                if (data?.history?.length > 0) {
                    displayQAHistory(data.history);
                }
            } catch (error) {
                console.error('Failed to load Q&A history:', error);
            }
        }

        function displayQAHistory(history) {
            const responseArea = document.getElementById('responseArea');
            if (!responseArea) return;

            if (history.length === 0) {
                responseArea.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        <p>${t('qa.emptyHistory')}</p>
                    </div>
                `;
                return;
            }

            let html = '';
            history.forEach(item => {
                const timestamp = item.created_at ? new Date(item.created_at).toLocaleString() : '';
                const confidence = item.confidence ? (item.confidence * 100).toFixed(0) + '%' : 'N/A';
                
                html += `
                    <div class="qa-item">
                        <div class="qa-question">${item.question}</div>
                        <div class="qa-answer">${item.answer.replace(/\n/g, '<br>')}</div>
                        <div class="qa-meta">
                            <span class="badge badge-success">${t('qa.confidence')}: ${confidence}</span>
                            <span>${timestamp}</span>
                        </div>
                    </div>
                `;
            });
            
            responseArea.innerHTML = html;
        }

        // ==================== Prompts ====================
        
        // Prompt名称中英文映射
        const promptNameMap = {
            '通用顾问': 'General Advisor',
            '销售顾问': 'Sales Advisor',
            'HR 顾问': 'HR Advisor',
            'HR顾问': 'HR Advisor',
            '技术顾问': 'Technical Advisor',
            '财务顾问': 'Finance Advisor',
            '供应链顾问': 'Supply Chain Advisor',
            '技术架构顾问': 'Tech Architecture Advisor',
            '销售分析顾问': 'Sales Analysis Advisor',
            '财务分析顾问': 'Finance Analysis Advisor',
            'HR政策顾问': 'HR Policy Advisor',
            '市场营销顾问': 'Marketing Advisor',
            '客户服务顾问': 'Customer Service Advisor',
            '项目管理顾问': 'Project Management Advisor',
            '数据分析顾问': 'Data Analysis Advisor'
        };
        
        // Prompt角色中英文映射 (role字段)
        const promptRoleMap = {
            'general_assistant': 'General Assistant',
            'sales_analyst': 'Sales Analyst',
            'hr_manager': 'HR Manager',
            'tech_architect': 'Tech Architect',
            'financial_analyst': 'Financial Analyst',
            'supply_chain_manager': 'Supply Chain Manager',
            '通用AI助手': 'General AI Assistant',
            '技术架构师': 'Technical Architect',
            '销售分析师': 'Sales Analyst',
            '财务分析师': 'Finance Analyst',
            'HR专家': 'HR Expert',
            '供应链专家': 'Supply Chain Expert',
            '市场营销专家': 'Marketing Expert',
            '客户服务专家': 'Customer Service Expert',
            '项目经理': 'Project Manager',
            '数据分析师': 'Data Analyst'
        };
        
        // Prompt描述中英文映射
        const promptDescriptionMap = {
            '通用知识查询和问题解答': 'General knowledge queries and Q&A',
            '销售数据分析和策略建议': 'Sales data analysis and strategy advice',
            '人力资源管理和员工发展': 'HR management and employee development',
            '技术架构和系统设计': 'Technical architecture and system design',
            '财务分析和成本优化': 'Financial analysis and cost optimization',
            '供应链优化和成本控制': 'Supply chain optimization and cost control'
        };
        
        // 部门名称中英文映射
        const departmentNameMap = {
            '销售部门': 'Sales Dept',
            '财务部门': 'Finance Dept',
            '人力资源': 'Human Resources',
            '技术部门': 'Technical Dept',
            '供应链': 'Supply Chain',
            '市场部门': 'Marketing Dept',
            '客户服务': 'Customer Service',
            '研发部门': 'R&D Dept'
        };
        
        // 翻译Prompt名称
        function translatePromptName(name) {
            if (currentLanguage === 'en') {
                return promptNameMap[name] || name;
            }
            return name;
        }
        
        // 翻译Prompt角色
        function translatePromptRole(role) {
            if (currentLanguage === 'en') {
                return promptRoleMap[role] || role.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            }
            return role;
        }
        
        // 翻译Prompt描述
        function translatePromptDescription(desc) {
            if (currentLanguage === 'en') {
                return promptDescriptionMap[desc] || desc;
            }
            return desc;
        }
        
        // 翻译部门名称
        function translateDepartmentName(name) {
            if (currentLanguage === 'en') {
                return departmentNameMap[name] || name;
            }
            return name;
        }
        
        async function loadPrompts() {
            try {
                const response = await fetch('/api/prompts');
                const data = await response.json();
                const prompts = data.templates || data.prompts || [];
                if (prompts.length > 0) {
                    displayPrompts(prompts);
                }
            } catch (error) {
                console.error('Failed to load prompts:', error);
            }
        }

        function displayPrompts(prompts) {
            const container = document.getElementById('promptContainer');
            if (!container) return;

            if (!prompts?.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                        <p>${t('common.noData')}</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="grid-cards">';
            
            prompts.forEach(prompt => {
                const preview = (prompt.system_prompt || '').substring(0, 100) + '...';
                const displayName = translatePromptName(prompt.name);
                const displayRole = translatePromptRole(prompt.role);
                const displayDesc = translatePromptDescription(prompt.description) || preview;
                html += `
                    <div class="feature-card">
                        <div class="feature-icon">${displayName.charAt(0)}</div>
                        <div class="feature-title">${displayName}</div>
                        <div class="feature-desc">${displayDesc}</div>
                        <div class="feature-badge">${displayRole}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // ==================== Navigation ====================
        
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            const page = document.querySelector(`[data-page-id="${pageId}"]`);
            if (page) page.classList.add('active');
            
            const navItem = document.querySelector(`[data-page="${pageId}"]`);
            if (navItem) navItem.classList.add('active');
            
            // Load LLM models when switching to LLM page
            if (pageId === 'llm') {
                loadLLMModels();
            }
            
            // Load monitor data when switching to monitor page
            if (pageId === 'monitor') {
                loadMonitorStatistics();
            }
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                switchPage(this.dataset.page);
            });
        });

        // ==================== Monitor Statistics ====================
        
        async function loadMonitorStatistics() {
            try {
                const response = await fetch('/api/monitor/statistics');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayMonitorStatistics(data);
                }
            } catch (error) {
                console.error('Failed to load monitor statistics:', error);
            }
        }
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        function displayMonitorStatistics(data) {
            const overview = data.overview || {};
            
            // 更新概览统计
            document.getElementById('totalQuestions').textContent = formatNumber(overview.total_questions || 0);
            document.getElementById('todayQuestions').textContent = `${currentLanguage === 'zh' ? '今日' : 'Today'}: ${overview.today_questions || 0}`;
            
            document.getElementById('totalRag').textContent = formatNumber(overview.total_rag_queries || 0);
            document.getElementById('todayRag').textContent = `${currentLanguage === 'zh' ? '今日' : 'Today'}: ${overview.today_rag_queries || 0}`;
            
            document.getElementById('totalTokens').textContent = formatNumber(overview.total_tokens || 0);
            document.getElementById('todayTokens').textContent = `${currentLanguage === 'zh' ? '今日' : 'Today'}: ${formatNumber(overview.today_tokens || 0)}`;
            
            document.getElementById('avgResponseTime').textContent = `${overview.avg_response_time || 0}s`;
            document.getElementById('avgConfidence').textContent = `${currentLanguage === 'zh' ? '置信度' : 'Confidence'}: ${overview.avg_confidence || 0}%`;
            
            // 显示Prompt使用统计
            displayPromptUsage(data.prompt_usage || []);
            
            // 显示部门数据使用统计
            displayDepartmentUsage(data.department_usage || []);
            
            // 显示7天趋势
            displayWeeklyTrend(data.daily_trend || []);
        }
        
        function displayPromptUsage(promptUsage) {
            const container = document.getElementById('promptUsageContainer');
            if (!container) return;
            
            if (promptUsage.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 30px;">
                        <p>${currentLanguage === 'zh' ? '暂无Prompt使用记录' : 'No prompt usage data'}</p>
                    </div>
                `;
                return;
            }
            
            const maxCount = Math.max(...promptUsage.map(p => p.count));
            const colors = ['#6366f1', '#34d399', '#f59e0b', '#ec4899', '#8b5cf6', '#06b6d4'];
            
            let html = '';
            promptUsage.forEach((item, index) => {
                const percentage = maxCount > 0 ? (item.count / maxCount * 100) : 0;
                const color = colors[index % colors.length];
                const displayName = translatePromptName(item.prompt_name);
                html += `
                    <div class="usage-item">
                        <span class="usage-name">${displayName}</span>
                        <div class="usage-bar-container">
                            <div class="usage-bar" style="width: ${percentage}%; background: ${color};"></div>
                        </div>
                        <span class="usage-count">${item.count}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function displayDepartmentUsage(deptUsage) {
            const container = document.getElementById('deptUsageContainer');
            if (!container) return;
            
            if (deptUsage.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 30px;">
                        <p>${currentLanguage === 'zh' ? '暂无部门数据使用记录' : 'No department usage data'}</p>
                    </div>
                `;
                return;
            }
            
            const maxCount = Math.max(...deptUsage.map(d => d.count));
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6'];
            
            let html = '';
            deptUsage.forEach((item, index) => {
                const percentage = maxCount > 0 ? (item.count / maxCount * 100) : 0;
                const color = colors[index % colors.length];
                const displayName = translateDepartmentName(item.name);
                html += `
                    <div class="usage-item">
                        <span class="usage-name">${displayName}</span>
                        <div class="usage-bar-container">
                            <div class="usage-bar" style="width: ${percentage}%; background: ${color};"></div>
                        </div>
                        <span class="usage-count">${item.count}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function displayWeeklyTrend(dailyTrend) {
            const container = document.querySelector('.trend-chart');
            if (!container) return;
            
            // 填充最近7天的数据
            const today = new Date();
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const found = dailyTrend.find(d => d.date === dateStr);
                last7Days.push({
                    date: dateStr,
                    label: date.toLocaleDateString(currentLanguage === 'zh' ? 'zh-CN' : 'en-US', { weekday: 'short' }),
                    count: found ? found.count : 0
                });
            }
            
            const maxCount = Math.max(...last7Days.map(d => d.count), 1);
            
            let html = '';
            last7Days.forEach(day => {
                const height = Math.max((day.count / maxCount) * 120, 10);
                html += `
                    <div class="trend-bar" style="height: ${height}px;">
                        <span class="trend-value">${day.count}</span>
                        <span class="trend-label">${day.label}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ==================== Tabs ====================
        
        function switchTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            const content = document.getElementById(`${tabName}-tab`);
            if (content) content.classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'trace') {
                displayTrace();
            }
        }

        // ==================== Q&A Functions ====================
        
        async function askQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            const enableTrace = document.getElementById('enableTrace').checked;
            
            if (!question) {
                alert(currentLanguage === 'zh' ? '请输入问题' : 'Please enter a question');
                return;
            }

            if (window.isAnswering) return;
            window.isAnswering = true;

            const askBtn = document.getElementById('askBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            askBtn.disabled = true;
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';

            let progress = 0;
            const progressInterval = setInterval(() => {
                if (progress < 90) {
                    progress += Math.random() * 15;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `Processing: ${Math.floor(progress)}%`;
                }
            }, 200);

            const responseArea = document.getElementById('responseArea');
            
            try {
                const response = await fetch('/api/trace/qa/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, token: null })
                });

                const data = await response.json();
                
                if (data.trace) {
                    window.currentTraceData = data.trace;
                }

                clearInterval(progressInterval);
                progressFill.style.width = '100%';

                setTimeout(() => {
                    displayResponse(data, enableTrace);
                    progressContainer.style.display = 'none';
                    askBtn.disabled = false;
                    window.isAnswering = false;
                }, 300);

                document.getElementById('questionInput').value = '';

            } catch (error) {
                console.error('Error:', error);
                clearInterval(progressInterval);
                
                const mockData = {
                    question,
                    answer: currentLanguage === 'zh' 
                        ? '根据您的问题进行分析...\n\n这是一个示例回答。实际回答将根据知识库检索结果和AI生成。'
                        : 'Analyzing your question...\n\nThis is a sample answer. The actual answer will be based on knowledge base retrieval and AI generation.',
                    confidence: 0.85,
                    execution_time: 0.45,
                    trace: {
                        trace_id: 'demo-' + Date.now(),
                        total_time: '0.45s',
                        total_steps: 3,
                        steps: [
                            { seq: 1, service: 'QA Entry', stage: 'Input Processing', purpose: 'Receive question', status: 'success' },
                            { seq: 2, service: 'RAG Service', stage: 'Knowledge Retrieval', purpose: 'Search documents', status: 'success' },
                            { seq: 3, service: 'LLM Service', stage: 'Response Generation', purpose: 'Generate answer', status: 'success' }
                        ]
                    }
                };
                window.currentTraceData = mockData.trace;
                displayResponse(mockData, enableTrace);
                
                progressContainer.style.display = 'none';
                askBtn.disabled = false;
                window.isAnswering = false;
            }
        }

        function displayResponse(data, showTrace) {
            const responseArea = document.getElementById('responseArea');
            const hasTrace = data.trace?.steps?.length > 0;
            
            const existingEmpty = responseArea.querySelector('.empty-state');
            if (existingEmpty) existingEmpty.remove();
            
            const html = `
                <div class="qa-item">
                    <div class="qa-question">${data.question || ''}</div>
                    <div class="qa-answer">${(data.answer || '').replace(/\n/g, '<br>')}</div>
                    <div class="qa-meta">
                        <span class="badge badge-success">${t('qa.confidence')}: ${((data.confidence || 0.8) * 100).toFixed(0)}%</span>
                        <span>${t('qa.duration')}: ${(data.execution_time || 0.5).toFixed(2)}s</span>
                        ${hasTrace ? `<button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="viewTrace()">${t('qa.viewTrace')}</button>` : ''}
                    </div>
                </div>
            `;
            responseArea.innerHTML = html + responseArea.innerHTML;
        }

        function viewTrace() {
            displayTrace();
            const traceTabs = document.querySelectorAll('.tab-btn');
            if (traceTabs[2]) traceTabs[2].click();
        }

        function displayTrace() {
            const trace = window.currentTraceData;
            const traceArea = document.getElementById('traceArea');
            
            if (!trace || !trace.steps?.length) {
                traceArea.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                        <p>${t('qa.emptyTrace')}</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-tertiary); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                    <div style="display: flex; gap: 24px; font-size: 13px;">
                        <div><span style="color: var(--text-muted);">Trace ID:</span> <span style="color: var(--text-primary); font-weight: 500;">${trace.trace_id}</span></div>
                        <div><span style="color: var(--text-muted);">Steps:</span> <span style="color: var(--text-primary); font-weight: 500;">${trace.total_steps}</span></div>
                        <div><span style="color: var(--text-muted);">Duration:</span> <span style="color: var(--text-primary); font-weight: 500;">${trace.total_time}</span></div>
                    </div>
                </div>
                <div class="trace-timeline">
            `;

            trace.steps.forEach(step => {
                let dataHtml = '';
                if (step.data && Object.keys(step.data).length > 0) {
                    dataHtml = '<div class="trace-data" style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed var(--border-color);">';
                    dataHtml += renderTraceData(step.data, 0);
                    dataHtml += '</div>';
                }
                
                html += `
                    <div class="trace-step ${step.status}">
                        <div class="trace-header">
                            <span class="trace-stage">${step.seq}. ${step.stage}</span>
                            <span class="trace-service">${step.service}</span>
                        </div>
                        <div class="trace-purpose">${step.purpose}</div>
                        ${dataHtml}
                    </div>
                `;
            });

            html += '</div>';
            traceArea.innerHTML = html;
        }
        
        // 递归渲染trace data对象
        function renderTraceData(data, depth) {
            if (depth > 3) return ''; // 限制递归深度
            let html = '';
            
            for (const [key, value] of Object.entries(data)) {
                const label = formatLabel(key);
                
                if (value === null || value === undefined) {
                    continue;
                } else if (Array.isArray(value)) {
                    if (value.length === 0) continue;
                    html += `<div class="trace-data-item" style="margin-bottom: 8px;">`;
                    html += `<span class="trace-data-label" style="color: var(--text-muted); font-size: 11px; display: block; margin-bottom: 4px;">${label}:</span>`;
                    html += `<div class="trace-data-list" style="padding-left: 12px;">`;
                    value.forEach((item, idx) => {
                        if (typeof item === 'object' && item !== null) {
                            html += `<div style="background: var(--bg-hover); padding: 8px; border-radius: 4px; margin-bottom: 4px; font-size: 11px;">`;
                            html += renderTraceData(item, depth + 1);
                            html += `</div>`;
                        } else {
                            html += `<div style="font-size: 11px; color: var(--text-secondary); padding: 2px 0;">• ${escapeHtml(String(item))}</div>`;
                        }
                    });
                    html += `</div></div>`;
                } else if (typeof value === 'object') {
                    html += `<div class="trace-data-item" style="margin-bottom: 8px;">`;
                    html += `<span class="trace-data-label" style="color: var(--text-muted); font-size: 11px; display: block; margin-bottom: 4px;">${label}:</span>`;
                    html += `<div style="padding-left: 12px; background: var(--bg-hover); border-radius: 4px; padding: 8px;">`;
                    html += renderTraceData(value, depth + 1);
                    html += `</div></div>`;
                } else {
                    const displayValue = typeof value === 'boolean' ? (value ? '✓ 是' : '✗ 否') : escapeHtml(String(value));
                    html += `<div class="trace-data-row" style="display: flex; gap: 8px; margin-bottom: 4px; font-size: 11px;">`;
                    html += `<span style="color: var(--text-muted); min-width: 100px;">${label}:</span>`;
                    html += `<span style="color: var(--text-secondary); flex: 1; word-break: break-word;">${displayValue}</span>`;
                    html += `</div>`;
                }
            }
            return html;
        }
        
        // 格式化字段名
        function formatLabel(key) {
            const labelMap = {
                'raw_question': '原始问题',
                'processed_question': '处理后问题',
                'question_length': '问题长度',
                'language_detected': '检测语言',
                'preprocessing_actions': '预处理动作',
                'user_id': '用户ID',
                'recognized_intent': '识别意图',
                'intent_code': '意图代码',
                'confidence_score': '置信度',
                'extracted_keywords': '提取关键词',
                'question_category': '问题类别',
                'entity_recognition': '实体识别',
                'routing_decision': '路由决策',
                'embedding_model': '嵌入模型',
                'vector_dimension': '向量维度',
                'tokenization': '分词信息',
                'encoding_method': '编码方法',
                'normalization': '归一化',
                'processing_status': '处理状态',
                'top_k': '检索数量',
                'found_documents': '找到文档数',
                'retrieval_status': '检索状态',
                'retrieved_documents': '检索到的文档',
                'title': '标题',
                'category': '类别',
                'content_preview': '内容预览',
                'source': '来源',
                'query_type': '查询类型',
                'target_systems': '目标系统',
                'query_parameters': '查询参数',
                'query_results': '查询结果',
                'integration_status': '集成状态',
                'user_info': '用户信息',
                'permission_check': '权限检查',
                'authorization_result': '授权结果',
                'audit_log': '审计日志',
                'selected_role': '选择角色',
                'selected_prompt': '选择Prompt',
                'template_version': '模板版本',
                'context_length': '上下文长度',
                'system_prompt_preview': '系统提示预览',
                'selection_reason': '选择原因',
                'model_selection': '模型选择',
                'model_config': '模型配置',
                'api_request': 'API请求',
                'api_response': 'API响应',
                'input_messages': '输入消息',
                'output_formatting': '输出格式化',
                'quality_metrics': '质量指标',
                'references': '参考引用',
                'final_answer_preview': '最终答案预览',
                'response_structure': '响应结构',
                'response_content': '响应内容',
                'trace_summary': '追踪摘要',
                'response_metadata': '响应元数据',
                'has_time_reference': '包含时间引用',
                'has_number': '包含数字',
                'has_department': '包含部门',
                'access_granted': '已授权',
                'authorized_data_types': '授权数据类型',
                'restricted_fields': '受限字段',
                'response_received': '已收到响应',
                'response_length': '响应长度',
                'response_preview': '响应预览',
                'finish_reason': '完成原因',
                'tokens_used': 'Token使用量',
                'prompt_tokens': 'Prompt Token',
                'completion_tokens': '完成 Token',
                'total_tokens': '总 Token',
                'latency_ms': '延迟(ms)',
                'answer_length': '答案长度',
                'answer_paragraphs': '段落数',
                'contains_list': '包含列表',
                'contains_numbers': '包含数字',
                'relevance_check': '相关性检查',
                'completeness': '完整性',
                'documents_cited': '引用文档数',
                'total_steps': '总步骤',
                'services_called': '调用服务',
                'total_execution_time_ms': '总执行时间(ms)',
                'timestamp': '时间戳',
                'trace_id': '追踪ID',
                'api_version': 'API版本'
            };
            return labelMap[key] || key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // HTML转义
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ==================== Search Functions ====================
        
        async function searchKnowledge() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Searching...</div>';

            try {
                const response = await fetch(`/api/rag/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.results?.length > 0) {
                    let html = '';
                    data.results.forEach(result => {
                        html += `
                            <div class="search-result">
                                <div class="search-result-title">${result.title || result.doc_id || 'Document'}</div>
                                <div class="search-result-content">${result.content?.substring(0, 200) || ''}...</div>
                                <div class="search-result-meta">
                                    <span class="tag">${result.category || 'General'}</span>
                                    <span>Score: ${(result.score * 100).toFixed(0)}%</span>
                                </div>
                            </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                } else {
                    resultsContainer.innerHTML = `
                        <div class="empty-state">
                            <p>No results found for "${query}"</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <p>Search failed. Please try again.</p>
                    </div>
                `;
            }
        }

        async function searchRagDocuments() {
            const query = document.getElementById('ragSearchInput').value.trim();
            if (!query) return;

            const resultsContainer = document.getElementById('ragResults');
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Searching...</div>';

            try {
                const response = await fetch(`/api/rag/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.results?.length > 0) {
                    let html = '';
                    data.results.forEach(result => {
                        html += `
                            <div class="search-result">
                                <div class="search-result-title">${result.title || result.doc_id || 'Document'}</div>
                                <div class="search-result-content">${result.content?.substring(0, 200) || ''}...</div>
                                <div class="search-result-meta">
                                    <span class="tag">${result.category || 'General'}</span>
                                    <span>Score: ${(result.score * 100).toFixed(0)}%</span>
                                </div>
                            </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                } else {
                    resultsContainer.innerHTML = `
                        <div class="empty-state">
                            <p>No documents found for "${query}"</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <p>Search failed. Please try again.</p>
                    </div>
                `;
            }
        }

        async function searchIntegrationKnowledge() {
            const query = document.getElementById('integrationSearchInput').value.trim();
            if (!query) return;

            const resultsContainer = document.getElementById('integrationResults');
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Searching...</div>';

            try {
                const response = await fetch(`/api/integration/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.results?.length > 0) {
                    let html = '';
                    data.results.forEach(result => {
                        html += `
                            <div class="search-result">
                                <div class="search-result-title">${result.title || 'Result'}</div>
                                <div class="search-result-content">${result.content?.substring(0, 200) || ''}...</div>
                                <div class="search-result-meta">
                                    <span class="tag">${result.source || 'Enterprise'}</span>
                                </div>
                            </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                } else {
                    resultsContainer.innerHTML = `<div class="empty-state"><p>No results found</p></div>`;
                }
            } catch (error) {
                resultsContainer.innerHTML = `<div class="empty-state"><p>Search failed</p></div>`;
            }
        }

        function searchIntegrationByCategory(category) {
            document.getElementById('integrationSearchInput').value = category;
            searchIntegrationKnowledge();
        }

        // ==================== LLM Models ====================
        
        async function loadLLMModels() {
            const container = document.getElementById('llmContainer');
            
            try {
                const response = await fetch('/api/llm/models');
                const data = await response.json();
                const models = data.models || [];
                
                if (models.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path></svg>
                            <p>${t('common.noData')}</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                models.forEach(model => {
                    html += `
                        <div class="model-card">
                            <div class="model-header">
                                <div class="model-name">${model.name}</div>
                                <div class="model-badges">
                                    ${model.is_default ? `<span class="model-badge default">${t('llm.default')}</span>` : ''}
                                    ${model.enabled ? `<span class="model-badge enabled">${t('llm.enabled')}</span>` : ''}
                                </div>
                            </div>
                            <div class="model-details">
                                <div class="model-detail">
                                    <div class="model-detail-label">${t('llm.provider')}</div>
                                    <div class="model-detail-value">${model.provider}</div>
                                </div>
                                <div class="model-detail">
                                    <div class="model-detail-label">${t('llm.maxTokens')}</div>
                                    <div class="model-detail-value">${model.max_tokens}</div>
                                </div>
                                <div class="model-detail">
                                    <div class="model-detail-label">${t('llm.temperature')}</div>
                                    <div class="model-detail-value">${model.temperature}</div>
                                </div>
                                <div class="model-detail">
                                    <div class="model-detail-label">Type</div>
                                    <div class="model-detail-value">${model.model_type || 'API'}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Failed to load models</p>
                    </div>
                `;
            }
        }

        // ==================== Event Listeners ====================
        
        document.getElementById('questionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') askQuestion();
        });

        document.getElementById('searchInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchKnowledge();
        });

        document.getElementById('ragSearchInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchRagDocuments();
        });

        document.getElementById('integrationSearchInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchIntegrationKnowledge();
        });

        // ==================== Initialize ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            hideLoadingMask();
            updatePageLanguage();
            loadInitialData();
        });

        if (document.readyState !== 'loading') {
            hideLoadingMask();
            updatePageLanguage();
            loadInitialData();
        }
    </script>
</body>
</html>
