# âœ… åŠ¨æ€æŸ¥è¯¢ç±»å‹æ˜ å°„å®ç°å®Œæˆ

## ğŸ¯ å®ç°æ‘˜è¦

æˆåŠŸå°†ç¡¬ç¼–ç çš„æŸ¥è¯¢ç±»å‹æ›¿æ¢ä¸ºåŠ¨æ€æ™ºèƒ½æ˜ å°„ç³»ç»Ÿã€‚ç³»ç»Ÿç°åœ¨æ ¹æ®ç”¨æˆ·é—®é¢˜çš„æ„å›¾è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æŸ¥è¯¢ç±»å‹ã€‚

## ğŸ“‹ å˜æ›´å†…å®¹

### 1. æ–°å¢ `DatabaseHelper.get_query_type_by_intent()` æ–¹æ³•
**ä½ç½®**: `/services/web_ui/main.py` (ç¬¬ 391-451 è¡Œ)

è¯¥æ–¹æ³•åŸºäºä¸¤ä¸ªå‚æ•°è¿›è¡Œæ˜ å°„ï¼š
- **intent**: é—®é¢˜çš„æ„å›¾åˆ†ç±»
- **question**: åŸå§‹ç”¨æˆ·é—®é¢˜

### 2. æŸ¥è¯¢ç±»å‹æ˜ å°„è§„åˆ™

#### ç»Ÿè®¡æŸ¥è¯¢ (Statistical Analysis)
| å…³é”®è¯ | æŸ¥è¯¢ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| é”€å”®, è®¢å•, æ”¶å…¥, é‡‘é¢, è´¹ç”¨ | `sales_statistics` | é”€å”®ç»Ÿè®¡æ•°æ® |
| å‘˜å·¥, äººå‘˜, æ‹›è˜, ç¦»èŒ | `hr_statistics` | äººåŠ›èµ„æºç»Ÿè®¡æ•°æ® |
| åº“å­˜, ç‰©å“, äº§å“, å•†å“ | `inventory_statistics` | åº“å­˜ç»Ÿè®¡æ•°æ® |
| æˆæœ¬, é¢„ç®—, è´¢åŠ¡, æ”¶æ”¯ | `finance_statistics` | è´¢åŠ¡ç»Ÿè®¡æ•°æ® |
| å…¶ä»– | `general_statistics` | é€šç”¨ç»Ÿè®¡æ•°æ® |

#### æ•°æ®æŸ¥è¯¢ (Data Query)
| å…³é”®è¯ | æŸ¥è¯¢ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| é”€å”®, ä¸šç»©, æŠ¥å‘Š, æˆæœ | `sales_report` | é”€å”®æŠ¥å‘Š |
| è´¢åŠ¡, æ”¶å…¥, æˆæœ¬, åˆ©æ¶¦ | `financial_report` | è´¢åŠ¡æŠ¥å‘Š |
| å‘˜å·¥, éƒ¨é—¨, ç»„ç»‡ | `hr_report` | äººåŠ›èµ„æºæŠ¥å‘Š |
| å®¢æˆ·, è®¢å• | `customer_report` | å®¢æˆ·è®¢å•æŠ¥å‘Š |
| å…¶ä»– | `general_report` | é€šç”¨æŠ¥å‘Š |

#### æ“ä½œæŒ‡å— (Operational Guide)
| å…³é”®è¯ | æŸ¥è¯¢ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| é”€å”®, è®¢å•, å‘è´§ | `sales_workflow` | é”€å”®æµç¨‹ |
| è´¢åŠ¡, è´¦åŠ¡, æ ¸ç®— | `finance_workflow` | è´¢åŠ¡æµç¨‹ |
| å…¶ä»– | `workflow_guide` | ä¸šåŠ¡æµç¨‹ |

#### æ¦‚å¿µè§£é‡Š (Concept Definition)
| å…³é”®è¯ | æŸ¥è¯¢ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| äº§å“, æœåŠ¡ | `product_reference` | äº§å“å‚è€ƒ |
| å…¶ä»– | `concept_reference` | æ¦‚å¿µå®šä¹‰ |

#### æ¯”è¾ƒåˆ†æ (Comparative Analysis)
| å…³é”®è¯ | æŸ¥è¯¢ç±»å‹ | è¯´æ˜ |
|------|--------|------|
| é”€å”®, ä¸šç»© | `sales_comparison` | é”€å”®æ•°æ®å¯¹æ¯” |
| å¸‚åœº, ç«äº‰ | `market_comparison` | å¸‚åœºæ•°æ®å¯¹æ¯” |
| å…¶ä»– | `data_comparison` | æ•°æ®åˆ†æå¯¹æ¯” |

#### é€šç”¨æŸ¥è¯¢ (Generic Query)
- æŸ¥è¯¢ç±»å‹: `general_query`
- è¯´æ˜: é€šç”¨æ•°æ®æŸ¥è¯¢

### 3. æ ¸å¿ƒæ”¹åŠ¨ç‚¹

**åŸä»£ç  (ç¬¬ 1144-1149 è¡Œ)**:
```python
chain.add_step(
    stage="ä¸Šä¸‹æ–‡å¢å¼º-æ•°æ®æŸ¥è¯¢",
    service="Integration Service (ERP)",
    purpose="ä»ä¼ä¸š ERP ç³»ç»ŸæŸ¥è¯¢å®æ—¶é”€å”®æ•°æ®",
    data={"query_type": "sales_report", "period": "Q1"}  # âŒ ç¡¬ç¼–ç 
)
```

**æ–°ä»£ç  (ç¬¬ 1142-1150 è¡Œ)**:
```python
# æ ¹æ®æ„å›¾åŠ¨æ€ç¡®å®šæŸ¥è¯¢ç±»å‹
query_type, query_purpose = DatabaseHelper.get_query_type_by_intent(intent, request.question)

chain.add_step(
    stage="ä¸Šä¸‹æ–‡å¢å¼º-æ•°æ®æŸ¥è¯¢",
    service="Integration Service (ERP)",
    purpose=f"ä»ä¼ä¸š ERP ç³»ç»Ÿ{query_purpose}",  # âœ… åŠ¨æ€ç”Ÿæˆ
    data={"query_type": query_type, "period": "Q1"}  # âœ… åŠ¨æ€ç”Ÿæˆ
)
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç»Ÿè®¡æŸ¥è¯¢æ„å›¾
âœ… "é”€å”®æŠ¥å‘Šæˆæœæ˜¯å¤šå°‘ï¼Ÿ" â†’ `sales_statistics`
âœ… "å‘˜å·¥æ‹›è˜çš„ç»Ÿè®¡æœ‰å¤šå°‘ï¼Ÿ" â†’ `hr_statistics`
âœ… "åº“å­˜äº§å“æœ‰å¤šå°‘ä¸ªï¼Ÿ" â†’ `inventory_statistics`
âœ… "æˆæœ¬é¢„ç®—æ•°æ®æ˜¯å¤šå°‘ï¼Ÿ" â†’ `finance_statistics`
âœ… "é€šç”¨ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ" â†’ `general_query`

### æ•°æ®æŸ¥è¯¢æ„å›¾
âœ… "é”€å”®ä¸šç»©æŠ¥å‘Šæ•°æ®æ˜¯ä»€ä¹ˆï¼Ÿ" â†’ `sales_report` (ç›®çš„: æŸ¥è¯¢é”€å”®æŠ¥å‘Š)
âœ… "å‘˜å·¥éƒ¨é—¨æ•°æ®ä¿¡æ¯ï¼Ÿ" â†’ `hr_report` (ç›®çš„: æŸ¥è¯¢äººåŠ›èµ„æºæŠ¥å‘Š)
âœ… "å®¢æˆ·è®¢å•æŠ¥å‘Šæœ‰å“ªäº›ï¼Ÿ" â†’ `sales_report` (ç›®çš„: æŸ¥è¯¢é”€å”®æŠ¥å‘Š)

### æ“ä½œæŒ‡å—æ„å›¾
âœ… "æ€æ ·è¿›è¡Œé”€å”®æ“ä½œï¼Ÿ" â†’ `sales_workflow` (ç›®çš„: æŸ¥è¯¢é”€å”®æµç¨‹)
âœ… "è´¢åŠ¡è´¦åŠ¡å¦‚ä½•æ ¸ç®—ï¼Ÿ" â†’ `finance_workflow` (ç›®çš„: æŸ¥è¯¢è´¢åŠ¡æµç¨‹)

## ğŸ“Š ç³»ç»ŸçŠ¶æ€

### Docker Lite éƒ¨ç½² - æ‰€æœ‰ 8 ä¸ªæœåŠ¡å¥åº·è¿è¡Œ âœ…
```
âœ” Container ai_lite_web_ui         Running
âœ” Container ai_lite_qa_entry       Running  
âœ” Container ai_lite_rag_service    Running
âœ” Container ai_lite_prompt_service Running
âœ” Container ai_lite_agent_service  Running
âœ” Container ai_lite_llm_service    Running
âœ” Container ai_lite_integration    Running
âœ” Container ai_lite_redis          Healthy
```

### API ç«¯ç‚¹
- **Trace ç«¯ç‚¹**: `POST /api/trace/qa/ask`
- **Health æ£€æŸ¥**: `GET /api/system/health`
- **Web UI**: `http://localhost:3000`

## ğŸ”„ è°ƒç”¨é“¾ç‰¹æ€§

æ¯ä¸ªæŸ¥è¯¢ç°åœ¨æ˜¾ç¤ºåŠ¨æ€è°ƒç”¨é“¾ï¼ŒåŒ…æ‹¬ï¼š
1. âœ… è¾“å…¥å¤„ç†
2. âœ… æ„å›¾è¯†åˆ« (5 ç§æ„å›¾)
3. âœ… çŸ¥è¯†æ£€ç´¢-å‘é‡åŒ–
4. âœ… çŸ¥è¯†æ£€ç´¢-å‘é‡æœç´¢
5. âœ… çŸ¥è¯†æ£€ç´¢-å…¨æ–‡æœç´¢
6. âœ… **ä¸Šä¸‹æ–‡å¢å¼º-æ•°æ®æŸ¥è¯¢** (åŠ¨æ€æŸ¥è¯¢ç±»å‹å’Œç›®çš„)
7. âœ… ä¸Šä¸‹æ–‡å¢å¼º-æƒé™æ ¡éªŒ
8. âœ… Prompt ç»„è£…
9. âœ… LLM æ¨ç†-æ¨¡å‹é€‰æ‹©
10. âœ… LLM æ¨ç†-API è°ƒç”¨
11. âœ… ç»“æœå¤„ç†-æ ¼å¼åŒ–
12. âœ… å“åº”è¿”å›

## ğŸ“ æ„å›¾åˆ†ç±»ç³»ç»Ÿ

ç³»ç»Ÿè¯†åˆ« 5 ç§é—®é¢˜æ„å›¾ï¼š

1. **ç»Ÿè®¡æŸ¥è¯¢** - "æœ‰å¤šå°‘", "æ•°é‡", "ç»Ÿè®¡"
2. **æ“ä½œæŒ‡å—** - "æ€æ ·", "å¦‚ä½•", "æ­¥éª¤"
3. **æ¦‚å¿µè§£é‡Š** - "ä»€ä¹ˆæ˜¯", "å®šä¹‰", "å«ä¹‰"
4. **æ¯”è¾ƒåˆ†æ** - "æ¯”è¾ƒ", "å¯¹æ¯”", "åŒºåˆ«"
5. **æ•°æ®æŸ¥è¯¢** - "æ•°æ®", "æŠ¥å‘Š", "ä¸šç»©", "æˆæœ"
6. **é€šç”¨æŸ¥è¯¢** - é»˜è®¤

## ğŸ¨ åŠŸèƒ½äº®ç‚¹

### æ™ºèƒ½æ„å›¾è¯†åˆ«
- å…³é”®è¯åŒ¹é…è‡ªåŠ¨è¯†åˆ«é—®é¢˜ç±»å‹
- æ”¯æŒå¤šç§ä¸­æ–‡è¡¨è¿°æ–¹å¼

### åŠ¨æ€æŸ¥è¯¢ç±»å‹é€‰æ‹©
- åŸºäºæ„å›¾å’Œé—®é¢˜å†…å®¹æ™ºèƒ½æ˜ å°„
- 8 ç§ä¸åŒçš„æŸ¥è¯¢ç±»å‹å¯é€‰

### é€æ˜çš„è°ƒç”¨é“¾è¿½è¸ª
- æ¯ä¸€æ­¥éƒ½æ˜¾ç¤ºå®é™…ä½¿ç”¨çš„å‚æ•°
- æ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§

### æ•°æ®åº“é©±åŠ¨é…ç½®
- Prompt æ¨¡æ¿ä»æ•°æ®åº“è¯»å–
- LLM æ¨¡å‹ä»æ•°æ®åº“é€‰æ‹©
- æ— ç¡¬ç¼–ç é…ç½®

## ğŸš€ åç»­æ”¹è¿›å»ºè®®

1. **æ‰©å±•æ„å›¾åˆ†ç±»**: å¢åŠ æ›´å¤šä¸“ä¸šé¢†åŸŸçš„æ„å›¾
2. **æœºå™¨å­¦ä¹ ä¼˜åŒ–**: ä½¿ç”¨ NLP æ¨¡å‹æ›¿ä»£å…³é”®è¯åŒ¹é…
3. **ç”¨æˆ·åé¦ˆä¼˜åŒ–**: æ ¹æ®ç”¨æˆ·é€‰æ‹©ä¼˜åŒ–æ„å›¾è¯†åˆ«
4. **ç¼“å­˜ä¼˜åŒ–**: ç¼“å­˜å¸¸è§é—®é¢˜çš„æ„å›¾å’ŒæŸ¥è¯¢ç±»å‹
5. **A/B æµ‹è¯•**: æµ‹è¯•ä¸åŒçš„æ„å›¾è¯†åˆ«ç­–ç•¥

## ğŸ“ æ”¯æŒä¿¡æ¯

### Docker éƒ¨ç½²
```bash
# å¯åŠ¨ Lite ç‰ˆæœ¬ (8 ä¸ªæœåŠ¡)
docker-compose -f docker-compose.lite.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.lite.yml logs -f web_ui

# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.lite.yml down
```

### æµ‹è¯• API
```bash
# å‘é€é—®é¢˜
curl -X POST http://localhost:3000/api/trace/qa/ask \
  -H "Content-Type: application/json" \
  -d '{"question":"é”€å”®æŠ¥å‘Šæˆæœæ˜¯å¤šå°‘ï¼Ÿ"}'

# æ£€æŸ¥ç³»ç»Ÿå¥åº·
curl http://localhost:3000/api/system/health
```

---

**å®ç°æ—¥æœŸ**: 2026-01-27  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
