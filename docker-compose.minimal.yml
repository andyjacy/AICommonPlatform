version: '3.8'

# 最小化轻量级本地部署 - 仅包含Web UI和知识库
# 使用场景：本地开发、快速测试
# 启动命令：docker-compose -f docker-compose.minimal.yml up -d
# 资源占用：~100MB内存（vs 330MB全服务）

services:
  # Web UI 服务
  web_ui:
    build:
      context: ./services/web_ui
      dockerfile: Dockerfile.lite
    container_name: ai_web_ui
    ports:
      - "3000:3000"
    environment:
      SERVICE_NAME: web_ui
      LOG_LEVEL: INFO
      DB_PATH: /app/data/web_ui.db
      # 本地模式：所有服务均不可用或指向本地
      QA_SERVICE_URL: http://localhost:8001
      PROMPT_SERVICE_URL: http://localhost:8002
      RAG_SERVICE_URL: http://rag_service:8000
      AGENT_SERVICE_URL: http://localhost:8004
      INTEGRATION_SERVICE_URL: http://localhost:8005
      LLM_SERVICE_URL: http://localhost:8006
    volumes:
      - ./data/web_ui:/app/data
      - ./services/web_ui/static:/app/static
    networks:
      - ai_minimal_net
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # RAG 服务 - 知识库
  rag_service:
    build:
      context: ./services/rag_service
      dockerfile: Dockerfile.lite
    container_name: ai_rag_service
    ports:
      - "8003:8000"
    environment:
      SERVICE_NAME: rag_service
      LITE_MODE: "true"
      LOG_LEVEL: INFO
    volumes:
      - ./data/documents:/app/data
    networks:
      - ai_minimal_net
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

networks:
  ai_minimal_net:
    driver: bridge
